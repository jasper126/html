<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Bay Sight – Woning Calculator Montenegro (2025 UI)</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>

<style>
:root{
  /* Bay Sight palette */
  --primary-blue:#042943;
  --primary-orange:#d4915f;
  --primary-turquoise:#00A5CF;

  --bg:#ffffff;
  --bg-alt:#f6f8fb;
  --border:#e6edf3;

  --text:#102a43;
  --muted:#65748b;

  --success:#31C48D;
  --warning:#F0B429;
  --error:#E12D39;

  /* radii & shadows */
  --r:16px;
  --shadow:0 10px 30px rgba(4,41,67,.08);
  --shadow-strong:0 18px 40px rgba(4,41,67,.12);
}

*{box-sizing:border-box}
html,body{
  margin:0;padding:0;background:var(--bg-alt);color:var(--text);
  font:16px/1.55 Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
}

.baysight-calculator-container{
  max-width:1120px; margin:28px auto; padding:0 16px;
}

.calculator-header{
  background:var(--primary-blue); color:#fff; border-radius:var(--r);
  padding:20px 24px; box-shadow:var(--shadow);
}
.calculator-header h2{ margin:0; font-size:24px; letter-spacing:.2px }
.calculator-header .bay-sight{ color:var(--primary-orange); font-weight:700 }

.calculator-tabs{
  display:flex; gap:8px; margin:14px 0 18px;
}
.tab{
  padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600;
  background:#fff; border:1px solid var(--border); color:var(--text);
  transition:all .2s ease;
}
.tab:hover{ box-shadow:0 0 0 3px rgba(0,165,207,.12) }
.tab.active{
  border-color:var(--primary-orange); box-shadow:0 0 0 3px rgba(212,145,95,.18)
}

.calculator-section{
  display:none;
}
.calculator-section.active{ display:block }

.progress-indicator{
  display:grid; grid-template-columns:repeat(4,1fr); gap:8px; margin:6px 0 18px;
}
.progress-step{
  background:#fff; border:1px solid var(--border); color:var(--muted);
  border-radius:12px; padding:10px 12px; text-align:center; font-weight:600;
}
.progress-step.active{ color:var(--primary-blue); border-color:var(--primary-blue) }
.progress-step.completed{ color:var(--success); border-color:var(--success) }

.input-form{
  background:#fff; border:1px solid var(--border); border-radius:var(--r);
  box-shadow:var(--shadow); padding:18px; margin-bottom:16px; display:none;
}
.input-form.active{ display:block }

.form-group{ margin-bottom:14px }
label{ display:block; margin-bottom:6px; font-size:13px; color:var(--muted) }
.form-control, .form-range, .toggle-label{
  width:100%;
}
.form-control{
  padding:10px 12px; border:1px solid var(--border); border-radius:12px; background:#fff; outline:none;
}
.form-control:focus{ border-color:var(--primary-turquoise); box-shadow:0 0 0 3px rgba(0,165,207,.15) }

.form-range{ appearance:none; height:32px; background:transparent }
.form-range::-webkit-slider-runnable-track{
  height:6px; background:#dde6ee; border-radius:999px
}
.form-range::-webkit-slider-thumb{
  appearance:none; width:18px; height:18px; border-radius:50%; background:var(--primary-orange);
  margin-top:-6px; box-shadow:0 2px 6px rgba(0,0,0,.15)
}
.range-value{ display:flex; justify-content:space-between; color:var(--muted); font-size:12px; margin-top:6px }

.toggle-container{ position:relative; width:56px; height:32px }
.toggle-input{ opacity:0; width:0; height:0 }
.toggle-label{
  display:block; height:100%; background:#dde6ee; border-radius:999px; position:relative; transition:.25s;
}
.toggle-label::before{
  content:""; position:absolute; left:4px; top:4px; width:24px; height:24px; background:#fff; border-radius:50%;
  box-shadow:0 2px 6px rgba(0,0,0,.15); transition:transform .25s
}
.toggle-input:checked + .toggle-label{ background:var(--primary-orange) }
.toggle-input:checked + .toggle-label::before{ transform:translateX(24px) }

.form-navigation{
  display:flex; gap:10px; justify-content:flex-end; margin-top:12px;
}
.btn{
  padding:10px 14px; border-radius:12px; font-weight:700; border:1px solid var(--border); cursor:pointer; background:#fff;
}
.btn-primary{ background:var(--primary-orange); border-color:var(--primary-orange); color:#fff }
.btn-secondary{ background:#fff }
.btn:hover{ box-shadow:var(--shadow) }
.btn:disabled{ opacity:.6; cursor:not-allowed }

.results-tabs{ display:flex; flex-wrap:wrap; gap:8px; border-bottom:1px solid var(--border); margin-bottom:12px }
.result-tab{
  padding:10px 12px; cursor:pointer; border-radius:10px 10px 0 0; font-weight:600; color:var(--muted)
}
.result-tab.active{ color:var(--primary-blue); border-bottom:2px solid var(--primary-orange) }

.result-panel{ display:none }
.result-panel.active{ display:block }

.summary-header{ margin-bottom:10px }
.property-info{ color:var(--muted) }

.summary-grid{
  display:grid; gap:16px; grid-template-columns:repeat(1,1fr);
}
@media(min-width:900px){ .summary-grid{ grid-template-columns:repeat(3,1fr) } }

.summary-card{
  background:#fff; border:1px solid var(--border); border-radius:var(--r); box-shadow:var(--shadow);
  padding:16px;
}
.summary-card h4{ margin:0 0 8px; color:var(--primary-blue) }
.summary-value{ font-size:22px; font-weight:800; margin-bottom:6px }

.chart-container{ height:300px; }

.data-table{ width:100%; border-collapse:collapse; background:#fff; border:1px solid var(--border); border-radius:var(--r); overflow:hidden; box-shadow:var(--shadow) }
.data-table th,.data-table td{ padding:10px; border-bottom:1px solid var(--border); text-align:left; font-size:14px }
.data-table th{ background:#fafcff; font-weight:800 }

.key-considerations, .panel-section, .country-comparison{
  background:#fff; border:1px solid var(--border); border-radius:var(--r); box-shadow:var(--shadow); padding:16px; margin-top:16px
}

.country-badge{
  display:inline-block; padding:2px 10px; border-radius:999px; font-weight:700; font-size:12px; border:1px solid transparent
}
.country-badge.montenegro{ background:var(--primary-orange); color:#fff; border-color:var(--primary-orange) }
.country-badge.spain{ background:#f1c40f; color:#1c2b39 }
.country-badge.portugal{ background:#27ae60; color:#fff }
.country-badge.italy{ background:#3498db; color:#fff }

.result-actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:16px; padding-top:12px; border-top:1px solid var(--border) }

@media(max-width:768px){
  .calculator-tabs{ flex-wrap:wrap }
  .progress-indicator{ grid-template-columns:1fr; }
  .form-navigation{ flex-direction:column; }
  .btn{ width:100% }
}
</style>
</head>
<body>
<div class="container">

  <div class="header">
    <h1><span>BAY SIGHT</span> – Woning Calculator Montenegro</h1>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="input">Gegevens invoeren</button>
    <button class="tab-btn" data-tab="results">Resultaten</button>
  </div>

  <!-- INPUT -->
  <section id="input" class="section active">
    <div class="grid cols-2">
      <div class="card"><div class="card-body">
        <h3>1. Woning</h3>
        <div class="row cols-2">
          <div>
            <label class="label" for="region">Regio</label>
            <select id="region">
              <option value="Kotor">Kotor</option><option value="Budva">Budva</option>
              <option value="Tivat">Tivat</option><option value="Bar">Bar</option>
            </select>
          </div>
          <div>
            <label class="label" for="propertyType">Type woning</label>
            <select id="propertyType">
              <option>Appartement</option><option>Villa</option>
              <option>Townhouse</option><option>Landhuis</option>
            </select>
          </div>
        </div>
        <div class="row cols-2" style="margin-top:12px">
          <div>
            <label class="label" for="propertySize">Woonoppervlakte (m²)</label>
            <input id="propertySize" type="number" class="input" placeholder="m²">
          </div>
          <div>
            <label class="label" for="landSize">Perceel (m²)</label>
            <input id="landSize" type="number" class="input" placeholder="m²">
          </div>
        </div>
        <div class="row cols-2" style="margin-top:12px">
          <div>
            <label class="label" for="purchasePrice">Aankoopprijs (€)</label>
            <input id="purchasePrice" type="number" class="input" value="150000" min="0">
          </div>
          <div>
            <label class="label" for="condition">Staat van onderhoud</label>
            <select id="condition">
              <option>Nieuwbouw</option><option>Uitstekend</option>
              <option selected>Goed</option><option>Redelijk</option><option>Renovatie nodig</option>
            </select>
          </div>
        </div>
      </div></div>

      <div class="card"><div class="card-body">
        <h3>2. Financieel</h3>
        <div class="row cols-3">
          <div>
            <label class="label" for="ownCapital">Eigen vermogen (€)</label>
            <input id="ownCapital" type="number" class="input" value="150000" min="0">
          </div>
          <div>
            <label class="label">Financiering nodig?</label>
            <select id="needFinancing">
              <option value="no" selected>Nee</option>
              <option value="yes">Ja</option>
            </select>
          </div>
          <div></div>
        </div>
        <div id="financingBox" style="display:none;margin-top:12px" class="row cols-3">
          <div>
            <label class="label" for="finAmount">Bedrag (€)</label>
            <input id="finAmount" type="number" class="input" value="0">
          </div>
          <div>
            <label class="label" for="finTerm">Looptijd (jaren)</label>
            <input id="finTerm" type="number" class="input" value="15" min="1" max="30">
          </div>
          <div>
            <label class="label" for="finType">Type</label>
            <select id="finType">
              <option>Hypotheek in Nederland</option><option>Lokale hypotheek</option><option>Anders</option>
            </select>
          </div>
        </div>

        <div style="margin-top:12px">
          <label class="label" for="investmentHorizon">Investeringshorizon (jaren)</label>
          <input type="range" id="investmentHorizon" class="range" min="1" max="30" value="15">
          <div class="note" style="text-align:right"> <span id="investmentHorizonValue">15</span> jaar</div>
        </div>
      </div></div>

      <div class="card"><div class="card-body">
        <h3>3. Gebruik</h3>
        <div class="row cols-2">
          <div>
            <label class="label" for="usageType">Primair gebruik</label>
            <select id="usageType">
              <option>Vakantiewoning</option><option>Permanente bewoning</option>
              <option>Verhuur</option><option>Combinatie</option>
            </select>
          </div>
          <div id="rentalTypeBox" style="display:none">
            <label class="label" for="rentalPeriod">Type verhuur</label>
            <select id="rentalPeriod">
              <option>Korte termijn (vakantieverhuur)</option>
              <option>Lange termijn (vaste huurder)</option>
              <option>Beide</option>
            </select>
          </div>
        </div>

        <div id="personalUseBox" style="display:none;margin-top:12px">
          <label class="label" for="personalUsageWeeks">Eigen gebruik (weken/jaar)</label>
          <input type="range" id="personalUsageWeeks" class="range" min="0" max="52" value="6">
          <div class="note" style="text-align:right"><span id="personalUsageWeeksValue">6</span> weken</div>
        </div>
      </div></div>

      <div class="card"><div class="card-body">
        <h3>4. Voorkeuren</h3>
        <div>
          <label class="label" for="returnImportance">Belang van rendement</label>
          <input type="range" id="returnImportance" class="range" min="1" max="10" value="7">
          <div class="note" style="text-align:right"><span id="returnImportanceValue">7</span>/10</div>
        </div>
        <div style="margin-top:12px">
          <label class="label" for="enjoymentImportance">Belang van gebruiksgenot</label>
          <input type="range" id="enjoymentImportance" class="range" min="1" max="10" value="8">
          <div class="note" style="text-align:right"><span id="enjoymentImportanceValue">8</span>/10</div>
        </div>
        <div style="margin-top:12px">
          <label class="label" for="managementPreference">Beheer voorkeur</label>
          <select id="managementPreference">
            <option>Zelf actief beheren</option><option selected>Gedeeltelijk uitbesteden</option><option>Volledig uitbesteden</option>
          </select>
        </div>
        <div class="hr"></div>
        <div class="actions">
          <button class="btn secondary" id="btnToResults">Naar resultaten</button>
          <button class="btn primary" id="btnCalculate">Bereken</button>
        </div>
      </div></div>
    </div>
  </section>

  <!-- RESULTS -->
  <section id="results" class="section">
    <div class="kpis">
      <div class="kpi"><div class="title">Totale investering</div><div id="kpiInvestment" class="value">—</div></div>
      <div class="kpi"><div class="title">Jaarlijks resultaat</div><div id="kpiAnnual" class="value">—</div></div>
      <div class="kpi"><div class="title">Totaal rendement</div><div id="kpiROI" class="value">—</div></div>
    </div>

    <div class="grid cols-3" style="margin-top:16px">
      <div class="card"><div class="card-body">
        <div class="title">Investering breakdown</div>
        <canvas id="chartInvest" height="190"></canvas>
      </div></div>

      <div class="card"><div class="card-body">
        <div class="title">Jaarlijks resultaat</div>
        <canvas id="chartAnnual" height="190"></canvas>
      </div></div>

      <div class="card"><div class="card-body">
        <div class="title">Waardeontwikkeling & Break-even</div>
        <canvas id="chartValue" height="190"></canvas>
        <div class="note" style="margin-top:8px">
          Break-even cashflow: <span id="breakevenCash">—</span> · Inclusief waardestijging: <span id="breakevenTotal">—</span>
        </div>
      </div></div>
    </div>

    <div class="grid cols-2" style="margin-top:16px">
      <div class="card"><div class="card-body">
        <h3>Initiële investering</h3>
        <table class="table">
          <thead><tr><th>Kostenpost</th><th>Bedrag</th><th>%</th></tr></thead>
          <tbody id="tblInit"></tbody>
          <tfoot><tr><th>Totaal</th><th id="tblInitTotal">—</th><th>100%</th></tr></tfoot>
        </table>
      </div></div>

      <div class="card"><div class="card-body">
        <h3>Jaarlijkse kosten</h3>
        <table class="table">
          <thead><tr><th>Kostenpost</th><th>Bedrag</th><th>%</th></tr></thead>
          <tbody id="tblAnnual"></tbody>
          <tfoot><tr><th>Totaal</th><th id="tblAnnualTotal">—</th><th>100%</th></tr></tfoot>
        </table>
      </div></div>
    </div>

    <div class="grid cols-2" style="margin-top:16px">
      <div class="card"><div class="card-body">
        <h3>Bruto verhuurinkomsten</h3>
        <canvas id="chartRental" height="190"></canvas>
        <div class="hr"></div>
        <table class="table">
          <thead><tr><th>Periode</th><th>Weekprijs</th><th>Bezetting</th><th>Inkomsten</th></tr></thead>
          <tbody id="tblRental"></tbody>
          <tfoot><tr><th>Totaal</th><th>-</th><th>-</th><th id="rentalTotal">—</th></tr></tfoot>
        </table>
      </div></div>

      <div class="card"><div class="card-body">
        <h3>Netto verhuurresultaat</h3>
        <canvas id="chartNet" height="190"></canvas>
        <div class="hr"></div>
        <table class="table">
          <tbody id="tblNet"></tbody>
        </table>
      </div></div>
    </div>

    <div class="card" style="margin-top:16px"><div class="card-body">
      <h3>Belangrijkste aandachtspunten</h3>
      <ul>
        <li>Buitenlanders kunnen vrijelijk onroerend goed kopen in Montenegro</li>
        <li>Notaris is verplicht bij overdracht</li>
        <li>Lage belastingtarieven vergeleken met West-Europa</li>
        <li>Geen vermogensbelasting</li>
        <li>Belastingverdrag met Nederland aanwezig; belasting wordt betaald in Montenegro</li>
      </ul>
      <div class="actions" style="margin-top:12px">
        <button class="btn secondary" onclick="window.print()">Opslaan als PDF</button>
        <button class="btn" id="btnBack">Opnieuw berekenen</button>
      </div>
    </div></div>

  </section>
</div>

<script>
/* ==== CONSTANTEN (exact zoals jouw berekeningen) ==== */
const TRANSFER_TAX_RATE = 0.03;
const NOTARY_RATE = 0.005;
const REGISTRATION_RATE = 0.003;
const AGENT_RATE = 0.03;
const LAWYER_FEE = 1500;

const PROPERTY_TAX_RATE = 0.001;
const RENTAL_TAX_RATE = 0.09;

const HIGH_SEASON_WEEKS = 12;
const LOW_SEASON_WEEKS  = 34;
const HIGH_SEASON_OCCUPANCY = 0.85;
const LOW_SEASON_OCCUPANCY  = 0.25;

const MANAGEMENT_RATE = 0.20;
const CLEANING_COST_PER_WEEK = 85;
const MARKETING_COST = 500;

const MONTENEGRO_APPRECIATION = 0.06;

/* ==== STATE ==== */
let region = 'Kotor';
let propertyType = 'Appartement';
let purchasePrice = 150000;
let investmentHorizon = 15;

let personalUseWeeks = 6; // (wordt alleen getoond; berekeningen blijven gelijk aan jouw versie)
let totals = {};          // voor charts/tables

/* ==== HELPERS ==== */
const € = v => '€' + (isFinite(v) ? Math.round(v).toLocaleString('nl-NL') : '—');
const pct = v => (isFinite(v) ? v.toLocaleString('nl-NL',{minimumFractionDigits:2,maximumFractionDigits:2}) : '—') + '%';

/* ==== UI HOOKS ==== */
const qs = s => document.querySelector(s);
const qsa = s => Array.from(document.querySelectorAll(s));

/* Tabs */
qsa('.tab-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    qsa('.tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    qsa('.section').forEach(sec=>sec.classList.remove('active'));
    qs('#'+btn.dataset.tab).classList.add('active');
  });
});

/* Inputs */
qs('#region').addEventListener('change', e => region = e.target.value);
qs('#propertyType').addEventListener('change', e => propertyType = e.target.value);
qs('#purchasePrice').addEventListener('input', e => purchasePrice = parseInt(e.target.value||'0',10));
qs('#investmentHorizon').addEventListener('input', e => {
  investmentHorizon = parseInt(e.target.value,10);
  qs('#investmentHorizonValue').textContent = investmentHorizon;
});
qs('#usageType').addEventListener('change', e => {
  const v = e.target.value;
  const show = v === 'Verhuur' || v === 'Combinatie';
  qs('#rentalTypeBox').style.display = show ? 'block' : 'none';
  qs('#personalUseBox').style.display = show ? 'block' : 'none';
});
qs('#personalUsageWeeks').addEventListener('input', e=>{
  personalUseWeeks = parseInt(e.target.value,10);
  qs('#personalUsageWeeksValue').textContent = personalUseWeeks;
});
qs('#needFinancing').addEventListener('change', e=>{
  qs('#financingBox').style.display = e.target.value === 'yes' ? 'grid' : 'none';
});

/* Buttons */
qs('#btnCalculate').addEventListener('click', ()=>{ calculate(); goResults(); });
qs('#btnToResults').addEventListener('click', ()=>{ calculate(); goResults(); });
qs('#btnBack').addEventListener('click', ()=>{ goInput(); });

function goResults(){
  qsa('.tab-btn').forEach(b=>b.classList.remove('active'));
  qsa('.section').forEach(s=>s.classList.remove('active'));
  document.querySelector('.tab-btn[data-tab="results"]').classList.add('active');
  qs('#results').classList.add('active');
}
function goInput(){
  qsa('.tab-btn').forEach(b=>b.classList.remove('active'));
  qsa('.section').forEach(s=>s.classList.remove('active'));
  document.querySelector('.tab-btn[data-tab="input"]').classList.add('active');
  qs('#input').classList.add('active');
}

/* ==== CORE CALC (zoals jouw script) ==== */
function calculate(){
  // Initiële kosten
  const transferTax = purchasePrice * TRANSFER_TAX_RATE;
  const notaryCosts = purchasePrice * NOTARY_RATE;
  const registrationCosts = purchasePrice * REGISTRATION_RATE;
  const agentCosts = purchasePrice * AGENT_RATE;
  const lawyerCosts = LAWYER_FEE;

  const totalInvestment = purchasePrice + transferTax + notaryCosts + registrationCosts + agentCosts + lawyerCosts;

  // Jaarlijkse kosten
  const propertyTax = purchasePrice * PROPERTY_TAX_RATE;
  const insurance = purchasePrice * 0.004;
  const utilities = 750;
  const maintenance = purchasePrice * 0.0075;
  const totalAnnualCosts = propertyTax + insurance + utilities + maintenance;

  // Verhuurinkomsten (zoals bij jou; personalUseWeeks niet verrekend)
  const highSeasonWeeklyRate = purchasePrice / 1000 * 5.33;
  const lowSeasonWeeklyRate  = highSeasonWeeklyRate * 0.44;

  const highSeasonIncome = HIGH_SEASON_WEEKS * highSeasonWeeklyRate * HIGH_SEASON_OCCUPANCY;
  const lowSeasonIncome  = LOW_SEASON_WEEKS  * lowSeasonWeeklyRate  * LOW_SEASON_OCCUPANCY;
  const totalRentalIncome = highSeasonIncome + lowSeasonIncome;

  // Netto verhuurresultaat
  const managementCosts = totalRentalIncome * MANAGEMENT_RATE;
  const occupiedWeeks = (HIGH_SEASON_WEEKS * HIGH_SEASON_OCCUPANCY) + (LOW_SEASON_WEEKS * LOW_SEASON_OCCUPANCY);
  const cleaningCosts = occupiedWeeks * CLEANING_COST_PER_WEEK;
  const marketingCosts = MARKETING_COST;

  const netRentalIncome = totalRentalIncome - managementCosts - cleaningCosts - marketingCosts;
  const rentalTax = netRentalIncome * RENTAL_TAX_RATE;
  const netAfterTax = netRentalIncome - rentalTax;

  // Jaarlijks resultaat
  const annualResult = netAfterTax - totalAnnualCosts;

  // Rendement
  const cashYield = (annualResult / totalInvestment) * 100;
  const appreciationYield = MONTENEGRO_APPRECIATION * 100;
  const totalYield = cashYield + appreciationYield;

  // Waardeontwikkeling
  const futureValue = purchasePrice * Math.pow(1 + MONTENEGRO_APPRECIATION, investmentHorizon);
  const totalAppreciation = futureValue - purchasePrice;

  // Break-even (zelfde formule als jouw script)
  const cashBreakEven = annualResult !== 0 ? (totalInvestment / annualResult) : Infinity;
  const totalBreakEven = Math.log(totalInvestment / purchasePrice + 1) / Math.log(1 + MONTENEGRO_APPRECIATION);

  totals = {
    transferTax, notaryCosts, registrationCosts, agentCosts, lawyerCosts, totalInvestment,
    propertyTax, insurance, utilities, maintenance, totalAnnualCosts,
    highSeasonWeeklyRate, lowSeasonWeeklyRate, highSeasonIncome, lowSeasonIncome, totalRentalIncome,
    managementCosts, cleaningCosts, marketingCosts, netRentalIncome, rentalTax, netAfterTax,
    annualResult, cashYield, appreciationYield, totalYield, futureValue, totalAppreciation,
    cashBreakEven, totalBreakEven
  };

  renderUI();
  renderCharts();
}

/* ==== RENDER ==== */
function renderUI(){
  // KPIs
  qs('#kpiInvestment').textContent = €(totals.totalInvestment);
  qs('#kpiAnnual').textContent     = €(totals.annualResult);
  qs('#kpiROI').textContent        = pct(totals.totalYield);

  // Init table
  const initRows = [
    ['Aankoopprijs', totals.purchasePrice = purchasePrice, purchasePrice / totals.totalInvestment * 100],
    ['Overdrachtsbelasting', totals.transferTax, totals.transferTax / totals.totalInvestment * 100],
    ['Notariskosten', totals.notaryCosts, totals.notaryCosts / totals.totalInvestment * 100],
    ['Registratiekosten', totals.registrationCosts, totals.registrationCosts / totals.totalInvestment * 100],
    ['Makelaarskosten', totals.agentCosts, totals.agentCosts / totals.totalInvestment * 100],
    ['Advocaatkosten', totals.lawyerCosts, totals.lawyerCosts / totals.totalInvestment * 100],
  ];
  qs('#tblInit').innerHTML = initRows.map(r=>(
    `<tr><td>${r[0]}</td><td>${€(r[1])}</td><td>${pct(r[2])}</td></tr>`
  )).join('');
  qs('#tblInitTotal').textContent = €(totals.totalInvestment);

  // Annual table
  const annRows = [
    ['Onroerendgoedbelasting', totals.propertyTax, totals.propertyTax / totals.totalAnnualCosts * 100],
    ['Verzekeringen', totals.insurance, totals.insurance / totals.totalAnnualCosts * 100],
    ['Nutsvoorzieningen', totals.utilities, totals.utilities / totals.totalAnnualCosts * 100],
    ['Onderhoud', totals.maintenance, totals.maintenance / totals.totalAnnualCosts * 100],
  ];
  qs('#tblAnnual').innerHTML = annRows.map(r=>(
    `<tr><td>${r[0]}</td><td>${€(r[1])}</td><td>${pct(r[2])}</td></tr>`
  )).join('');
  qs('#tblAnnualTotal').textContent = €(totals.totalAnnualCosts);

  // Rental table
  qs('#tblRental').innerHTML = `
    <tr><td>Hoogseizoen</td><td>${€(totals.highSeasonWeeklyRate)}</td><td>85%</td><td>${€(totals.highSeasonIncome)}</td></tr>
    <tr><td>Laagseizoen</td><td>${€(totals.lowSeasonWeeklyRate)}</td><td>25%</td><td>${€(totals.lowSeasonIncome)}</td></tr>`;
  qs('#rentalTotal').textContent = €(totals.totalRentalIncome);

  // Net rental table
  qs('#tblNet').innerHTML = `
    <tr><td>Bruto verhuurinkomsten</td><td>${€(totals.totalRentalIncome)}</td></tr>
    <tr><td>Beheerkosten (20%)</td><td>-${€(totals.managementCosts)}</td></tr>
    <tr><td>Schoonmaakkosten</td><td>-${€(totals.cleaningCosts)}</td></tr>
    <tr><td>Marketingkosten</td><td>-${€(totals.marketingCosts)}</td></tr>
    <tr><td>Netto verhuurinkomsten</td><td>${€(totals.netRentalIncome)}</td></tr>
    <tr><td>Lokale belasting (9%)</td><td>-${€(totals.rentalTax)}</td></tr>
    <tr><th>Netto na belasting</th><th>${€(totals.netAfterTax)}</th></tr>
  `;

  // Break-even text
  qs('#breakevenCash').textContent  = isFinite(totals.cashBreakEven) ? totals.cashBreakEven.toFixed(1) + ' jaar' : 'n.v.t.';
  qs('#breakevenTotal').textContent = totals.totalBreakEven.toFixed(1) + ' jaar';
}

/* ==== CHARTS ==== */
let chartInvest, chartAnnual, chartValue, chartRental, chartNet;

function make(ctx, cfg){ if(ctx && ctx._chart) { ctx._chart.destroy(); } const c = new Chart(ctx, cfg); ctx._chart = c; return c; }

function renderCharts(){
  // invest
  chartInvest && chartInvest.destroy();
  chartInvest = make(document.getElementById('chartInvest').getContext('2d'), {
    type:'doughnut',
    data:{
      labels:['Aankoopprijs','Aankoopkosten'],
      datasets:[{data:[purchasePrice, totals.totalInvestment - purchasePrice], backgroundColor:['#042943','#d4915f']}]
    },
    options:{plugins:{legend:{position:'bottom'}}}
  });

  // annual
  chartAnnual && chartAnnual.destroy();
  const totalCostsAll = totals.totalAnnualCosts + totals.managementCosts + totals.cleaningCosts + totals.marketingCosts + totals.rentalTax;
  chartAnnual = make(document.getElementById('chartAnnual').getContext('2d'), {
    type:'bar',
    data:{
      labels:['Inkomsten','Kosten','Resultaat'],
      datasets:[{data:[totals.totalRentalIncome, totalCostsAll, totals.annualResult], backgroundColor:['#31C48D','#E12D39','#d4915f']}]
    },
    options:{plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
  });

  // value
  chartValue && chartValue.destroy();
  const labels = Array.from({length: investmentHorizon+1}, (_,i)=>i);
  const values = labels.map(t => purchasePrice * Math.pow(1+MONTENEGRO_APPRECIATION,t));
  const cashCum = labels.map(t => -totals.totalInvestment + totals.annualResult * t);
  const totalCum= labels.map(t => -totals.totalInvestment + totals.annualResult * t + (purchasePrice * Math.pow(1+MONTENEGRO_APPRECIATION,t) - purchasePrice));
  chartValue = make(document.getElementById('chartValue').getContext('2d'), {
    type:'line',
    data:{
      labels,
      datasets:[
        {label:'Waarde', data:values, borderColor:'#d4915f', backgroundColor:'rgba(212,145,95,.12)', fill:true, tension:.2},
        {label:'Cumulatieve cashflow', data:cashCum, borderColor:'#E12D39', backgroundColor:'rgba(225,45,57,.08)', fill:true, tension:.2},
        {label:'Cashflow + waardestijging', data:totalCum, borderColor:'#31C48D', backgroundColor:'rgba(49,196,141,.10)', fill:true, tension:.2},
      ]
    },
    options:{plugins:{legend:{position:'bottom'}}}
  });

  // rental
  chartRental && chartRental.destroy();
  chartRental = make(document.getElementById('chartRental').getContext('2d'), {
    type:'bar',
    data:{
      labels:['Hoogseizoen','Laagseizoen'],
      datasets:[{data:[totals.highSeasonIncome, totals.lowSeasonIncome], backgroundColor:['#d4915f','#f0c6a5']}]
    },
    options:{plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
  });

  // net
  chartNet && chartNet.destroy();
  chartNet = make(document.getElementById('chartNet').getContext('2d'), {
    type:'bar',
    data:{
      labels:['Bruto inkomsten','Kosten','Belasting','Netto resultaat'],
      datasets:[{data:[
        totals.totalRentalIncome,
        -(totals.managementCosts + totals.cleaningCosts + totals.marketingCosts),
        -totals.rentalTax,
        totals.netAfterTax
      ], backgroundColor:['#31C48D','#E12D39','#f18b95','#042943']}]
    },
    options:{plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
  });
}

/* Auto initial calculation & show results quickly */
calculate();
</script>
</body>
</html>
