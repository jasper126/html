<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAY SIGHT Woning Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            /* Primaire kleuren (Aangepaste Baysight huisstijl) */
            --primary-blue: #042943;
            --primary-orange: #d4915f;
            --primary-turquoise: #00A5CF;
            
            /* Secundaire kleuren */
            --secondary-light: #F0F4F8;
            --secondary-medium: #D9E2EC;
            --secondary-dark: #627D98;
            
            /* Functionele kleuren */
            --success: #31C48D;
            --warning: #F0B429;
            --error: #E12D39;
            
            /* Tekst kleuren */
            --text-primary: #102A43;
            --text-secondary: #486581;
            --text-light: #829AB1;
            
            /* Achtergrond kleuren */
            --bg-light: #FFFFFF;
            --bg-off-white: #F8FAFC;
            --bg-highlight: #EFF6FF;
        }

        body {
            font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
            font-size: 16px;
            line-height: 1.5;
            color: var(--text-primary);
            background-color: var(--bg-off-white);
            margin: 0;
            padding: 2rem 1rem;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .baysight-calculator-container {
            width: 100%;
            max-width: 1160px;
            margin: 0 auto;
            background-color: var(--bg-light);
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1), 0 5px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .calculator-header {
            background-color: var(--primary-blue);
            color: white;
            padding: 2rem 1.5rem; /* Meer padding voor grotere titel */
            text-align: center;
        }

        .calculator-header h2 {
            margin: 0;
            font-size: 3.5rem; /* Groter lettertype */
            font-family: 'DM Serif Display', serif;
            font-weight: 400;
            color: var(--primary-orange);
            text-transform: uppercase; /* Titel in hoofdletters */
        }

        .calculator-tabs {
            display: flex;
            background-color: var(--secondary-light);
            border-bottom: 1px solid var(--secondary-medium);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1 1 auto;
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            text-align: center;
        }

        .tab:hover {
            background-color: var(--bg-highlight);
        }

        .tab.active {
            color: var(--primary-blue);
            border-bottom: 3px solid var(--primary-orange);
            background-color: var(--bg-light);
        }
        .tab.disabled {
            color: var(--text-light);
            cursor: not-allowed;
            background-color: var(--secondary-light);
        }


        .calculator-section {
            display: none;
            padding: 2rem;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .calculator-section.active {
            display: block;
        }

        .progress-indicator {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--secondary-medium);
            padding-bottom: 1rem;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            padding: 0.5rem;
            position: relative;
            color: var(--text-light);
            font-weight: 500;
        }

        .progress-step.active {
            color: var(--primary-blue);
            font-weight: 700;
        }

        .progress-step.completed {
            color: var(--primary-blue);
            font-weight: 500;
        }
        .progress-step.completed::before {
            content: '✔';
            color: var(--success);
            margin-right: 0.5rem;
        }


        .progress-step::after {
            content: '';
            position: absolute;
            bottom: -1rem;
            left: 50%;
            transform: translateX(-50%);
            width: 1rem;
            height: 1rem;
            background-color: var(--secondary-medium);
            border-radius: 50%;
            border: 2px solid var(--bg-off-white);
            transition: background-color 0.3s ease;
        }

        .progress-step.active::after {
            background-color: var(--primary-orange);
            transform: translateX(-50%) scale(1.2);
        }

        .progress-step.completed::after {
            background-color: var(--success);
        }

        .input-form {
            display: none;
        }

        .input-form.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-control {
            box-sizing: border-box;
            display: block;
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            line-height: 1.5;
            color: var(--text-primary);
            background-color: var(--bg-light);
            border: 1px solid var(--secondary-medium);
            border-radius: 4px;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .form-control:focus {
            border-color: var(--primary-turquoise);
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0, 165, 207, 0.25);
        }
        
        .label-with-tooltip {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .label-with-tooltip label {
            margin-bottom: 0;
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: var(--secondary-medium);
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        
        input[type="range"]:hover {
            opacity: 1;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: var(--primary-orange);
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: var(--primary-orange);
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }


        .range-value {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .range-value .current-value {
            font-weight: 700;
            color: var(--primary-blue);
            background-color: var(--bg-highlight);
            padding: 0.1rem 0.5rem;
            border-radius: 4px;
        }
        
        .toggle-switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--secondary-light);
            padding: 0.75rem;
            border-radius: 8px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--secondary-dark);
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-orange);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .toggle-label-text {
            font-weight: 600;
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }
        
        .toggle-label-text.inactive {
            color: var(--text-light);
            font-weight: 500;
        }

        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-decoration: none;
        }

        .btn-primary {
            background-color: var(--primary-orange);
            color: white;
        }

        .btn-primary:hover {
            background-color: #c07e4d;
            color: white;
            box-shadow: 0 4px 10px rgba(212, 145, 95, 0.4);
        }

        .btn-secondary {
            background-color: var(--secondary-medium);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background-color: var(--secondary-dark);
            color: white;
        }

        .btn:disabled {
            background-color: var(--secondary-medium);
            opacity: 0.7;
            cursor: not-allowed;
            box-shadow: none;
        }
        .btn:disabled:hover {
            background-color: var(--secondary-medium);
            color: var(--text-primary);
        }

        .results-tabs {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--secondary-medium);
        }
        .results-tabs::-webkit-scrollbar {
            height: 5px;
        }
        .results-tabs::-webkit-scrollbar-thumb {
            background: var(--secondary-medium); 
            border-radius: 10px;
        }


        .result-tab {
            padding: 0.75rem 1.25rem;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px; /* Align with border */
            white-space: nowrap;
        }

        .result-tab:hover {
            color: var(--primary-blue);
        }

        .result-tab.active {
            color: var(--primary-blue);
            border-bottom-color: var(--primary-orange);
        }

        .result-panel {
            display: none;
            animation: fadeIn 0.5s;
        }

        .result-panel.active {
            display: block;
        }

        .summary-header {
            margin-bottom: 1.5rem;
        }
        .summary-header h3 {
            color: var(--primary-blue);
        }

        .property-info {
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background-color: var(--bg-light);
            border: 1px solid var(--secondary-light);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.08);
        }

        .summary-card h4 {
            margin-top: 0;
            margin-bottom: 1rem;
            color: var(--primary-blue);
        }

        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--primary-orange);
        }

        .summary-chart-container {
            height: 250px;
        }

        .panel-section {
            margin-bottom: 2.5rem;
        }

        .panel-section h4 {
            color: var(--primary-blue);
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--secondary-light);
            padding-bottom: 0.5rem;
        }

        .chart-container {
            height: 350px;
            margin-bottom: 1.5rem;
            width: 100%;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
        }

        .data-table th, .data-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--secondary-medium);
            vertical-align: middle;
        }

        .data-table th {
            background-color: var(--secondary-light);
            font-weight: 600;
        }
        .data-table tbody tr:hover {
            background-color: var(--bg-highlight);
        }
        .data-table .total-row td {
            font-weight: 700;
            color: var(--primary-blue);
        }
        
        .data-table td.numeric-cell {
            text-align: right;
            font-feature-settings: "tnum"; /* Tabular nums for alignment */
            font-weight: 500;
        }
        .data-table td.numeric-cell strong {
            font-weight: 700;
        }


        .considerations-list {
            background-color: var(--bg-highlight);
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 5px solid var(--primary-turquoise);
            margin-top: 2rem;
        }
        .considerations-list h4 {
            margin-top: 0;
            color: var(--primary-blue);
        }

        .considerations-list ul {
            margin: 0;
            padding-left: 1.5rem;
        }

        .considerations-list li {
            margin-bottom: 0.75rem;
        }

        .result-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--secondary-medium);
        }
        
        .country-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.875rem;
            color: white;
        }

        .country-badge.montenegro { background-color: var(--primary-orange); }
        .country-badge.spanje { background-color: var(--warning); color: var(--text-primary); }
        .country-badge.portugal { background-color: var(--primary-turquoise); }
        .country-badge.italie { background-color: var(--success); }
        
        .country-cell-inner {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
            vertical-align: middle;
        }

        .tooltip .tooltip-icon {
            font-style: normal;
            font-weight: 700;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background-color: var(--secondary-dark);
            color: white;
            font-size: 12px;
            margin-left: 8px;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 280px;
            background-color: var(--primary-blue);
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -140px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            line-height: 1.4;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--primary-blue) transparent transparent transparent;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        .cta-section {
            background-color: var(--secondary-light);
            border-radius: 8px;
            padding: 2.5rem;
            margin-top: 2rem;
            border: 1px solid var(--secondary-medium);
        }

        .cta-content {
            display: flex;
            align-items: center;
            gap: 2.5rem;
        }
        
        .cta-icon-container {
            flex-shrink: 0;
            color: var(--primary-orange);
        }

        .cta-icon-container svg {
            width: 80px;
            height: 80px;
        }

        .cta-text {
            flex-grow: 1;
        }

        .cta-text h2 {
            font-family: 'DM Serif Display', serif;
            color: var(--primary-blue);
            font-size: 2rem;
            margin-top: 0;
            margin-bottom: 1rem;
        }

        .cta-text p {
            margin-bottom: 1.5rem;
            color: var(--text-secondary);
        }
        
        .cta-form-inputs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .cta-form-inputs .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .btn-cta {
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
        }

        @media (max-width: 1159px) {
            .summary-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            body { padding: 0; }
            .baysight-calculator-container { border-radius: 0; }
            .calculator-section { padding: 1.5rem; }
            .calculator-header h2 { font-size: 2.5rem; }

            .progress-indicator {
                flex-direction: column;
                border-bottom: none;
                gap: 0.5rem;
                padding-bottom: 0;
            }

            .progress-step {
                text-align: left;
                padding: 0.5rem 0;
                border-bottom: 1px solid var(--secondary-medium);
            }

            .progress-step::after {
                display: none;
            }
            
            .form-navigation {
                flex-direction: column-reverse;
                gap: 1rem;
            }

            .result-actions {
                 flex-direction: column;
                 align-items: stretch;
            }

            .btn {
                width: 100%;
                box-sizing: border-box;
            }
            
            .cta-content {
                flex-direction: column;
                text-align: center;
                gap: 1.5rem;
            }
            .cta-form-inputs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="baysight-calculator-container" id="main-container">
        <div class="calculator-header">
            <h2>Woning Calculator</h2>
        </div>

        <div class="calculator-tabs">
            <div class="tab active" data-tab="input">Start & Invoer</div>
            <div class="tab disabled" data-tab="results">Resultaten</div>
        </div>
        
        <div class="calculator-section active" id="input-section">
            <div class="progress-indicator">
                <div class="progress-step active" data-step="1">1. Woning</div>
                <div class="progress-step" data-step="2">2. Financieel</div>
                <div class="progress-step" data-step="3">3. Gebruik</div>
                <div class="progress-step" data-step="4">4. Voorkeuren</div>
            </div>
            
            <div class="input-form active" id="step-0">
                <div class="panel-section">
                    <h4>Uitleg van de Calculator</h4>
                    <p>Deze calculator is ontworpen om u een gedetailleerd en realistisch inzicht te geven in het potentiële rendement van een vastgoedinvestering. Onze berekeningen zijn niet zomaar schattingen; ze zijn gebaseerd op een diepgaande analyse van de meest recente, openbare data.</p>
                    
                    <h5>Onze Databronnen</h5>
                    <ul>
                        <li><strong>Nationale Statistische Bureaus:</strong> Gegevens over vastgoedprijzen, transactievolumes en economische indicatoren zijn afkomstig van de officiële CBS-equivalenten van elk land, zoals MONSTAT (Montenegro), INE (Spanje), INE Portugal, en ISTAT (Italië).</li>
                        <li><strong>Belastingautoriteiten:</strong> Alle berekeningen van overdrachtsbelasting, jaarlijkse eigendomsbelasting en belasting op huurinkomsten zijn gebaseerd op de officiële, meest recente tarieven en wetgeving van de respectievelijke belastingdiensten.</li>
                        <li><strong>Onafhankelijke Marktanalyse:</strong> Voor parameters zoals gemiddelde huurrendementen en beheerkosten maken we gebruik van data van gerenommeerde, onafhankelijke vastgoedanalisten zoals de Global Property Guide, en analyses van financiële instellingen zoals PwC en BBVA Research.</li>
                    </ul>

                    <h5>Transparante Berekeningen</h5>
                    <p>De tool berekent dynamisch de kosten en opbrengsten voor uw specifieke situatie. Wanneer u een aankoopprijs invoert, wordt voor elk land een parallelle berekening gemaakt van de transactiekosten en het te verwachten netto huurrendement. Dit stelt u in staat om een eerlijke, data-gedreven vergelijking te maken.</p>
                    
                    <div class="considerations-list" style="border-left-color: var(--warning);">
                         <h4>Disclaimer</h4>
                         <p>Hoewel we streven naar maximale nauwkeurigheid, dient deze calculator als een indicatief hulpmiddel. De vastgoedmarkt is dynamisch en werkelijke resultaten kunnen afwijken. Deze berekening vormt geen financieel advies. Wij raden u ten zeerste aan om contact op te nemen voor een persoonlijk adviesgesprek om uw specifieke situatie te bespreken.</p>
                    </div>
                </div>
            </div>

            <div class="input-form" id="step-1">
                <h3>Woninggegevens in Montenegro</h3>
                
                <div class="form-group">
                    <label for="purchasePrice">Aankoopprijs (€)</label>
                    <input type="number" id="purchasePrice" class="form-control" placeholder="bv. 250000" value="250000" min="0">
                </div>

                <div class="form-group">
                    <label for="furnishingCosts">Inrichtingskosten (€) (Optioneel)</label>
                    <input type="number" id="furnishingCosts" class="form-control" placeholder="bv. 20000" min="0">
                </div>
                
                <div class="form-group">
                    <label for="propertyCondition">Staat van de woning</label>
                    <select id="propertyCondition" class="form-control">
                        <option value="new">Nieuwbouw</option>
                        <option value="existing">Bestaande bouw</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="propertySize">Woonoppervlakte (m²)</label>
                    <input type="number" id="propertySize" class="form-control" min="20" placeholder="bv. 80" value="80">
                </div>
                
                <div class="form-group">
                    <div class="label-with-tooltip">
                        <label for="region">Regio</label>
                        <span class="tooltip">
                            <i class="tooltip-icon">i</i>
                            <span class="tooltip-text">De gekozen regio beïnvloedt de geschatte huurprijzen en de bezettingsgraad, wat direct impact heeft op het berekende rendement. Kustgebieden hebben doorgaans een hoger toeristisch potentieel.</span>
                        </span>
                    </div>
                    <select id="region" class="form-control">
                        <option value="Kotor">Baai van Kotor</option>
                        <option value="Budva">Budva Riviera</option>
                        <option value="Tivat">Tivat & Luštica</option>
                        <option value="Bar">Bar & Ulcinj</option>
                        <option value="Noord">Noord (Binnenland)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="propertyType">Type woning</label>
                    <select id="propertyType" class="form-control">
                        <option value="Appartement">Appartement</option>
                        <option value="Villa">Villa</option>
                        <option value="Landhuis">Landhuis</option>
                    </select>
                </div>
            </div>

            <div class="input-form" id="step-2">
                <h3>Financiële gegevens</h3>
                
                <div class="form-group">
                    <label for="ownCapital">Beschikbaar eigen vermogen (€)</label>
                    <input type="number" id="ownCapital" class="form-control" placeholder="bv. 150000" value="150000" min="0">
                    <div id="capital-warning" style="color: var(--warning); font-size: 0.9rem; margin-top: 0.5rem; display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label>Heeft u financiering nodig? <small style="font-weight: 400; color: var(--text-secondary);">(bv. via opname overwaarde)</small></label>
                    <div class="toggle-switch-container">
                        <span class="toggle-label-text active" id="no-financing-label">Nee</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="needFinancing">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label-text inactive" id="yes-financing-label">Ja</span>
                    </div>
                </div>
                
                <div class="financing-details" style="display: none;">
                    <div class="form-group">
                        <label for="financingInterestRate">Rentepercentage (%)</label>
                        <input type="number" id="financingInterestRate" class="form-control" min="0" max="20" step="0.1" value="5.5">
                    </div>
                    
                    <div class="form-group">
                        <label for="financingTerm">Looptijd financiering (jaren)</label>
                        <input type="number" id="financingTerm" class="form-control" min="1" max="30" value="20">
                    </div>
                </div>
            </div>

            <div class="input-form" id="step-3">
                <h3>Gebruiksgegevens</h3>
                
                <div class="form-group">
                    <label for="usageType">Primair gebruiksdoel</label>
                    <select id="usageType" class="form-control">
                        <option value="Combinatie">Combinatie (Eigen gebruik & Verhuur)</option>
                        <option value="Vakantiewoning">Alleen eigen gebruik (Vakantiewoning)</option>
                        <option value="LangeTermijnVerhuur">Volledige Lange Termijn Verhuur</option>
                        <option value="KorteTermijnVerhuur">Volledige Korte Termijn Verhuur (Vakantie)</option>
                    </select>
                </div>
                
                <div class="rental-details">
                        <div class="form-group">
                            <label for="personalUsageWeeks">Aantal weken per jaar voor eigen gebruik</label>
                            <input type="range" id="personalUsageWeeks" class="form-range" min="0" max="52" value="4">
                            <div class="range-value">
                                <span>0 weken</span>
                                <span class="current-value" id="personalUsageWeeksValue">4</span>
                                <span>52 weken</span>
                            </div>
                        </div>
                </div>
            </div>

            <div class="input-form" id="step-4">
                <h3>Voorkeuren</h3>
                <div class="form-group">
                    <label for="managementPreference">Voorkeur voor beheer (indien verhuur)</label>
                    <select id="managementPreference" class="form-control">
                        <option value="Volledig uitbesteden">Volledig uitbesteden (Aanbevolen)</option>
                        <option value="Gedeeltelijk uitbesteden">Gedeeltelijk uitbesteden</option>
                        <option value="Zelf actief beheren">Zelf actief beheren</option>
                    </select>
                </div>
            </div>
            
            <div class="form-navigation">
                <button class="btn btn-secondary btn-prev" disabled>Vorige</button>
                <button class="btn btn-primary btn-next">Volgende</button>
                <button class="btn btn-primary btn-calculate" style="display: none;">Bereken</button>
            </div>
        </div>
        
        <div class="calculator-section" id="results-section">
            <div class="results-tabs">
                <div class="result-tab active" data-result="summary">Samenvatting</div>
                <div class="result-tab" data-result="financial">Investering & Kosten</div>
                <div class="result-tab" data-result="rental">Verhuurpotentieel</div>
                <div class="result-tab" data-result="roi">Rendement Analyse</div>
            </div>
            
            <div class="result-panel active" id="summary-panel">
                <div class="summary-header">
                    <h3>Uw Investeringsprofiel</h3>
                    <div class="property-info">
                        <span id="summary-property-type">Appartement</span> in 
                        <span id="summary-region">Baai van Kotor</span>,
                        <span>Montenegro</span>
                    </div>
                </div>
                
                <div class="summary-grid">
                    <div class="summary-card">
                        <h4>Totale Investering</h4>
                        <div class="summary-value" id="summary-total-investment">€0</div>
                        <p>Bestaat uit aankoopprijs en alle bijkomende kosten.</p>
                    </div>
                    
                    <div class="summary-card">
                        <h4>Netto Jaarlijks Resultaat</h4>
                        <div class="summary-value" id="summary-annual-result">€0</div>
                        <p>Netto cashflow na aftrek van alle jaarlijkse kosten.</p>
                    </div>
                    
                    <div class="summary-card">
                        <h4>Netto Huurrendement</h4>
                        <div class="summary-value" id="summary-rental-yield">0%</div>
                        <p>Direct rendement uit verhuur op jaarbasis.</p>
                    </div>

                    <div class="summary-card">
                        <h4>Verwachte Waardestijging</h4>
                        <div class="summary-value" id="summary-appreciation">0%</div>
                        <p>Gemiddelde prognose per jaar (historisch).</p>
                    </div>
                </div>

                <div class="panel-section">
                    <h4>Landenvergelijking (Netto Huurrendement)</h4>
                    <p>Uw geschatte resultaten in Montenegro vergeleken met vergelijkbare investeringen in andere populaire landen, gebaseerd op de ingevoerde aankoopprijs en financiële gegevens.</p>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="country-comparison-chart"></canvas>
                    </div>
                </div>
                
                <div class="panel-section">
                    <h4>Historische Prijsontwikkeling (2019-2024)</h4>
                    <p>Gebaseerd op officieel onderzoek toont deze grafiek de vastgoedwaardestijging, vergeleken met andere populaire Zuid-Europese landen.</p>
                    <div class="chart-container">
                        <canvas id="cumulative-appreciation-chart"></canvas>
                    </div>
                </div>

            </div>

            <div class="result-panel" id="financial-panel">
                <div class="panel-section">
                    <h4>Investeringsopbouw (Montenegro)</h4>
                    <p>De totale bijkomende kosten in Montenegro. In de tabel hieronder vindt u een gedetailleerde vergelijking met andere landen.</p>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="investment-breakdown-chart"></canvas>
                    </div>
                </div>
                
                <div class="panel-section">
                    <h4>Vergelijking Eenmalige Aankoopkosten</h4>
                    <p>Een overzicht van de geschatte bijkomende kosten ('Kosten Koper') voor uw ingevoerde aankoopprijs, vergeleken per land. De waarden zijn gebaseerd op de door u verstrekte data voor buitenlandse kopers.</p>
                    <table class="data-table" id="onetime-costs-comparison-table"></table>
                </div>
                <div class="panel-section">
                    <h4>Jaarlijkse Operationele Kosten (Montenegro)</h4>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="annual-costs-chart"></canvas>
                    </div>
                    <table class="data-table" id="costs-table"></table>
                </div>
                <div class="considerations-list" style="border-left-color: var(--primary-turquoise);">
                    <h4>Toelichting op de Kosten</h4>
                     <ul>
                        <li>De berekeningen van de eenmalige aankoopkosten zijn gebaseerd op de door u aangeleverde onderzoeksdocumenten voor 2024.</li>
                        <li>Voor kosten die in de documenten als een percentage-range werden opgegeven (bv. 6-10%), is voor de berekening een gemiddelde of representatief tarief gebruikt.</li>
                        <li><b>Belangrijke Aanname (Italië):</b> De registratiebelasting en notariskosten in Italië zijn gebaseerd op de kadastrale waarde. Aangezien deze niet bekend is, is voor deze berekening een realistische schatting gebruikt waarbij de kadastrale waarde 60% van de marktwaarde (aankoopprijs) bedraagt.</li>
                        <li>Deze cijfers dienen als een nauwkeurige indicatie, maar kunnen in de praktijk afwijken. Raadpleeg altijd een lokale specialist voor een definitieve kostenopgave.</li>
                     </ul>
                </div>
            </div>

            <div class="result-panel" id="rental-panel">
                <div class="panel-section">
                    <h4>Verhuurinkomsten Prognose (Jaarlijks)</h4>
                    <table class="data-table" id="rental-income-table"></table>
                </div>
                <div class="panel-section">
                    <h4>Netto Verhuurresultaat</h4>
                    <table class="data-table" id="net-rental-result-table"></table>
                </div>
                <div class="considerations-list">
                    <h4>Aandachtspunten bij verhuur</h4>
                    <ul>
                        <li>De bezettingsgraad is een realistische schatting en kan variëren op basis van marketing, seizoensinvloeden en de kwaliteit van de woning.</li>
                        <li>Huurprijzen zijn marktconform en kunnen fluctueren. Regelmatige evaluatie is aanbevolen.</li>
                        <li>Professioneel beheer via een partij als Bay Sight kan zorgen voor een hogere bezettingsgraad en minder zorgen.</li>
                    </ul>
                </div>
            </div>
            
            <div class="result-panel" id="roi-panel">
                <div class="panel-section">
                    <h4>Analyse van Rendement</h4>
                    <table class="data-table" id="roi-table"></table>
                </div>
                <div class="considerations-list">
                    <h4>Toelichting Rendement</h4>
                    <ul>
                        <li><b>Netto Huurrendement:</b> Dit is het directe, jaarlijkse rendement uit verhuurinkomsten, afgezet tegen uw totale investering. Het toont de directe winstgevendheid van het pand.</li>
                        <li><b>Cash-on-Cash Rendement:</b> Dit belangrijke kengetal meet hoeveel cash u jaarlijks overhoudt (na alle kosten, inclusief financiering) ten opzichte van het eigen geld dat u daadwerkelijk heeft ingelegd.</li>
                    </ul>
                </div>
            </div>
            
            <div class="panel-section cta-section" id="lead-form-panel">
                <div class="cta-content">
                    <div class="cta-icon-container">
                        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                    </div>
                    <div class="cta-text">
                        <h2>Klaar voor de Volgende Stap?</h2>
                        <p>Heeft deze analyse uw interesse gewekt? Laat uw naam en e-mailadres achter. Een van onze specialisten neemt vrijblijvend contact met u op om uw vragen te beantwoorden en een persoonlijke toelichting te geven op uw investeringsmogelijkheden.</p>
                        <form id="contact-form">
                            <div class="cta-form-inputs">
                                <div class="form-group">
                                    <label for="userName">Naam</label>
                                    <input type="text" id="userName" name="name" class="form-control" required placeholder="Uw volledige naam">
                                </div>
                                <div class="form-group">
                                    <label for="userEmail">E-mailadres</label>
                                    <input type="email" id="userEmail" name="email" class="form-control" required placeholder="uw.email@voorbeeld.com">
                                </div>
                            </div>
                            <button type="submit" id="submit-form-btn" class="btn btn-primary btn-cta">Ja, neem contact met mij op</button>
                            <div id="form-status" style="text-align: center; margin-top: 1rem; font-weight: 600;"></div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="result-actions">
                <button class="btn btn-secondary" id="back-to-input">← Aanpassen</button>
                <a href="https://www.baysight.nl/contact/" target="_blank" class="btn btn-secondary">Direct contact opnemen</a>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    // --- STATE VARIABLES ---
    let currentStep = 0;
    let charts = {};
    let lastCalculation = {};

    // --- DOM ELEMENTEN ---
    const formSteps = document.querySelectorAll('.input-form');
    const progressSteps = document.querySelectorAll('.progress-step');
    const nextBtn = document.querySelector('.btn-next');
    const prevBtn = document.querySelector('.btn-prev');
    const calculateBtn = document.querySelector('.btn-calculate');
    const mainTabs = document.querySelectorAll('.tab');
    const calculatorSections = document.querySelectorAll('.calculator-section');
    const resultTabs = document.querySelectorAll('.result-tab');
    const resultPanels = document.querySelectorAll('.result-panel');
    const needFinancingToggle = document.getElementById('needFinancing');
    const financingDetails = document.querySelector('.financing-details');
    const usageTypeSelect = document.getElementById('usageType');
    const rentalDetails = document.querySelector('.rental-details');
    const personalUsageWeeksSlider = document.getElementById('personalUsageWeeks');
    const contactForm = document.getElementById('contact-form');
    const purchasePriceInput = document.getElementById('purchasePrice');
    
    // --- Event Listeners ---
    function setupListeners() {
        nextBtn.addEventListener('click', () => {
            const totalForms = document.querySelectorAll('.input-form').length - 1;
            if (currentStep < totalForms) {
                currentStep++;
                updateFormState();
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentStep > 0) {
                currentStep--;
                updateFormState();
            }
        });
        
        calculateBtn.addEventListener('click', runCalculation);
        purchasePriceInput.addEventListener('input', () => {
            if (currentStep === 1) updateFormState();
        });
        if (contactForm) contactForm.addEventListener('submit', handleFormSubmit);
        mainTabs.forEach(tab => tab.addEventListener('click', () => switchMainTab(tab)));
        resultTabs.forEach(tab => tab.addEventListener('click', () => switchResultTab(tab)));
        
        document.getElementById('back-to-input').addEventListener('click', () => {
            switchMainTab(document.querySelector('.tab[data-tab="input"]'));
        });

        needFinancingToggle.addEventListener('change', () => {
            financingDetails.style.display = needFinancingToggle.checked ? 'block' : 'none';
            document.getElementById('yes-financing-label').classList.toggle('active', needFinancingToggle.checked);
            document.getElementById('yes-financing-label').classList.toggle('inactive', !needFinancingToggle.checked);
            document.getElementById('no-financing-label').classList.toggle('active', !needFinancingToggle.checked);
            document.getElementById('no-financing-label').classList.toggle('inactive', needFinancingToggle.checked);
        });
        
        usageTypeSelect.addEventListener('change', () => {
            const usage = usageTypeSelect.value;
            rentalDetails.style.display = (usage === 'Combinatie') ? 'block' : 'none';
            if (usage !== 'Combinatie' && usage !== 'Vakantiewoning') {
                 personalUsageWeeksSlider.value = 0;
                 personalUsageWeeksSlider.dispatchEvent(new Event('input'));
            }
        });
        
        setupRangeSlider('personalUsageWeeks', 'personalUsageWeeksValue');
    }

    // --- Navigatie & UI Functies ---
    function updateFormState() {
        const isStartScreen = currentStep === 0;
        document.querySelector('.progress-indicator').style.display = isStartScreen ? 'none' : 'flex';
        
        progressSteps.forEach((step, index) => {
            const stepNum = index + 1;
            step.classList.toggle('active', stepNum === currentStep);
            step.classList.toggle('completed', stepNum < currentStep);
        });

        formSteps.forEach(form => form.classList.remove('active'));
        document.getElementById(`step-${currentStep}`).classList.add('active');
        prevBtn.disabled = isStartScreen;
        
        const totalForms = document.querySelectorAll('.input-form').length - 1;
        nextBtn.style.display = currentStep === totalForms ? 'none' : 'inline-block';
        calculateBtn.style.display = currentStep === totalForms ? 'inline-block' : 'none';
        
        nextBtn.disabled = (currentStep === 1 && (parseFloat(purchasePriceInput.value) || 0) <= 0);
    }
    
    function switchMainTab(tab) {
        if (tab.classList.contains('disabled')) return;
        mainTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        calculatorSections.forEach(s => s.classList.remove('active'));
        document.getElementById(`${tab.dataset.tab}-section`).classList.add('active');
        if (tab.dataset.tab === 'input') {
            currentStep = 0;
            updateFormState();
        }
    }
    
    function switchResultTab(tab) {
        resultTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        resultPanels.forEach(p => p.classList.remove('active'));
        const activePanel = document.getElementById(`${tab.dataset.result}-panel`);
        if (activePanel) {
            activePanel.classList.add('active');
            drawChartsForPanel(tab.dataset.result);
        }
    }
    
    function setupRangeSlider(sliderId, displayId) {
        const slider = document.getElementById(sliderId);
        const display = document.getElementById(displayId);
        if(!slider || !display) return;
        const update = () => { display.textContent = slider.value; };
        slider.addEventListener('input', update);
        update();
    }

    // --- CTA Formulier Afhandeling ---
    function handleFormSubmit(event) {
        event.preventDefault();
        const statusDiv = document.getElementById('form-status');
        const submitBtn = document.getElementById('submit-form-btn');
        const userName = document.getElementById('userName').value;
        const userEmail = document.getElementById('userEmail').value;

        if (!userName || !userEmail) {
            statusDiv.textContent = 'Vul alstublieft uw naam en e-mailadres in.';
            statusDiv.style.color = 'var(--error)';
            return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Bezig met versturen...';
        statusDiv.textContent = '';

        setTimeout(() => {
            statusDiv.textContent = 'Bedankt voor uw aanvraag! Wij nemen spoedig contact met u op.';
            statusDiv.style.color = 'var(--success)';
            submitBtn.textContent = 'Verzonden!';
            contactForm.reset();

            setTimeout(() => {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Ja, neem contact met mij op';
                statusDiv.textContent = '';
            }, 5000);
        }, 1500);
    }

    // --- Kernberekeningen ---
    function runCalculation() {
        const inputs = gatherInputs();
        const results = calculateAll(inputs);
        lastCalculation = { inputs, results }; 
        displayResults(inputs, results);
        const resultsTab = document.querySelector('.tab[data-tab="results"]');
        resultsTab.classList.remove('disabled');
        switchMainTab(resultsTab);
    }
    
    function gatherInputs() {
        return {
            purchasePrice: parseFloat(document.getElementById('purchasePrice').value) || 0,
            furnishingCosts: parseFloat(document.getElementById('furnishingCosts').value) || 0,
            isNewBuild: document.getElementById('propertyCondition').value === 'new',
            propertyType: document.getElementById('propertyType').value,
            region: document.getElementById('region').value,
            ownCapital: parseFloat(document.getElementById('ownCapital').value) || 0,
            needFinancing: document.getElementById('needFinancing').checked,
            financingInterestRate: parseFloat(document.getElementById('financingInterestRate').value) / 100 || 0,
            financingTerm: parseInt(document.getElementById('financingTerm').value) || 0,
            usageType: document.getElementById('usageType').value,
            managementPreference: document.getElementById('managementPreference').value,
        };
    }
    
    function calculateAll(inputs) {
        return {
            montenegro: calculateCountry(inputs, 'Montenegro'),
            spanje: calculateCountry(inputs, 'Spanje'),
            portugal: calculateCountry(inputs, 'Portugal'),
            italië: calculateCountry(inputs, 'Italië')
        };
    }
    
    // =========================================================================================
    // START GECORRIGEERDE CALCULATIE FUNCTIE (GEBASEERD OP NIEUWSTE DATA)
    // =========================================================================================
    function calculateCountry(inputs, country) {
        const results = {};
        const { purchasePrice, isNewBuild, region, furnishingCosts, managementPreference, usageType, needFinancing, financingInterestRate, financingTerm, ownCapital } = inputs;
        
        results.purchasePrice = purchasePrice || 0;
        let params = {};
        let costBreakdown = {};

        switch(country) {
            case 'Montenegro':
                params = { managementFeeRate: { "Volledig uitbesteden": 0.10, "Gedeeltelijk uitbesteden": 0.08, "Zelf actief beheren": 0.05 }[managementPreference]};
                // Belasting: 3% op bestaand, 0% voor koper bij nieuwbouw (BTW zit in prijs)
                costBreakdown.tax = isNewBuild ? 0 : purchasePrice * 0.03;
                costBreakdown.notaryCosts = 550; // Gemiddelde van €300-€800
                costBreakdown.registrationCosts = 100; // Gemiddelde van €50-€150
                costBreakdown.legalCosts = 550; // Gemiddelde van €300-€800
                costBreakdown.translatorCosts = 150; // Gemiddelde van €100-€200
                break;
            case 'Spanje':
                params = { managementFeeRate: 0.10, effectiveTaxRate: 0.19 };
                // Belasting: 10% BTW + 1.5% Zegelrecht (nieuw) vs 8% overdracht (bestaand)
                costBreakdown.tax = isNewBuild ? purchasePrice * 0.115 : purchasePrice * 0.08;
                costBreakdown.notaryCosts = purchasePrice * 0.0075; // Gemiddelde 0.5-1%
                costBreakdown.registrationCosts = purchasePrice * 0.0075; // Gemiddelde 0.5-1%
                costBreakdown.legalCosts = purchasePrice * 0.0125; // Gemiddelde 1-1.5%
                costBreakdown.otherCosts = 200; // NIE
                break;
            case 'Portugal':
                params = { managementFeeRate: 0.08, effectiveTaxRate: 0.28 };
                costBreakdown.tax = purchasePrice * 0.045; // Gemiddelde van 1-8%
                costBreakdown.stampDuty = purchasePrice * 0.008;
                costBreakdown.notaryRegistrationCosts = 1500; // Gemiddelde van €1000-€2000
                costBreakdown.legalCosts = purchasePrice * 0.0125; // Gemiddelde 1-1.5%
                break;
            case 'Italië':
                params = { managementFeeRate: 0.10, taxOnGross: true };
                // Belasting: 9% voor tweede huis
                costBreakdown.tax = purchasePrice * 0.09;
                costBreakdown.notaryCosts = 3500; // Gemiddelde van €2000-€5000
                costBreakdown.brokerageCosts = purchasePrice * 0.025; // Gemiddelde van 2-3%
                costBreakdown.otherCosts = (125 + 500); // Kadaster + vertaling
                break;
        }
        results.costBreakdown = costBreakdown;
        
        const totalOneTimeCosts = Object.values(costBreakdown).reduce((sum, val) => sum + (val || 0), 0);
        results.totalInvestment = purchasePrice + totalOneTimeCosts + furnishingCosts;
        
        // Financiering en jaarlijkse kosten
        results.annualFinancingCost = 0;
        if(needFinancing) {
            const financingAmount = Math.max(0, results.totalInvestment - ownCapital);
            if (financingAmount > 0 && financingTerm > 0 && financingInterestRate > 0) {
                const r = financingInterestRate / 12;
                const n = financingTerm * 12;
                const monthlyPayment = (financingAmount * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
                if (isFinite(monthlyPayment)) results.annualFinancingCost = monthlyPayment * 12;
            }
        }
        
        const regionYieldMultipliers = { 'Kotor': 1.05, 'Budva': 1.15, 'Tivat': 1.10, 'Bar': 0.95, 'Noord': 0.80 };
        const regionMultiplier = regionYieldMultipliers[region] || 1.0;
        const grossYieldRate = country === 'Montenegro' ? 0.065 * regionMultiplier : { 'Spanje': 0.06, 'Portugal': 0.055, 'Italië': 0.055 }[country];
        
        let grossAnnualRentalIncome = (usageType !== 'Vakantiewoning' && purchasePrice > 0) ? purchasePrice * grossYieldRate : 0;
        results.grossAnnualRentalIncome = grossAnnualRentalIncome;
        results.rentalManagementFee = grossAnnualRentalIncome * params.managementFeeRate;
        results.netAnnualRentalIncome = grossAnnualRentalIncome - results.rentalManagementFee;
        
        results.annualPropertyTax = purchasePrice * (0.25/100);
        results.annualInsurance = purchasePrice * 0.002;
        results.annualMaintenance = purchasePrice * 0.008;
        results.totalAnnualCostsBeforeFinancing = results.annualPropertyTax + results.annualInsurance + results.annualMaintenance;

        let taxAmount = 0;
        if (country === 'Montenegro') taxAmount = results.netAnnualRentalIncome * 0.09;
        else if (params.taxOnGross) taxAmount = grossAnnualRentalIncome * params.effectiveTaxRate;
        else if (params.effectiveTaxRate) taxAmount = Math.max(0, results.netAnnualRentalIncome - results.totalAnnualCostsBeforeFinancing) * params.effectiveTaxRate;
        
        results.taxAmount = taxAmount;

        results.netAnnualCashflow = results.netAnnualRentalIncome - results.totalAnnualCostsBeforeFinancing - results.annualFinancingCost - results.taxAmount;
        results.netRentalYield = (results.totalInvestment > 0) ? results.netAnnualCashflow / results.totalInvestment : 0;
        
        return results;
    }

    // --- Weergave Functies ---
    function displayResults(inputs, allResults) {
        const { montenegro } = allResults;
        const formatCurrency = (value) => value || value === 0 ? new Intl.NumberFormat('nl-NL', { style: 'currency', currency: 'EUR' }).format(value) : '-';
        const formatPercent = (value, digits = 1) => value || value === 0 ? new Intl.NumberFormat('nl-NL', { style: 'percent', minimumFractionDigits: digits, maximumFractionDigits: digits }).format(value) : '-';

        document.getElementById('summary-property-type').textContent = inputs.propertyType;
        document.getElementById('summary-region').textContent = document.querySelector(`#region option[value="${inputs.region}"]`).textContent;
        document.getElementById('summary-total-investment').textContent = formatCurrency(montenegro.totalInvestment);
        document.getElementById('summary-annual-result').textContent = formatCurrency(montenegro.netAnnualCashflow);
        document.getElementById('summary-rental-yield').textContent = formatPercent(montenegro.netRentalYield, 2);
        
        displayOnetimeCostComparison(allResults, inputs.purchasePrice, formatCurrency, formatPercent);
        displayAnnualAndRoi(inputs, allResults, formatCurrency, formatPercent);
        
        drawChartsForPanel('summary', allResults);
        drawChartsForPanel('financial', allResults);
    }
    
    function displayOnetimeCostComparison(allResults, purchasePrice, formatCurrency, formatPercent) {
        const costKeys = [
            { key: 'tax', label: 'Overdrachtsbelasting / BTW', tooltip: 'Belasting op aankoop. Voor bestaande bouw is dit 3% in ME, ca. 8% in ES, ca. 4.5% in PT, en 9% in IT. Voor nieuwbouw is dit 0% in ME (BTW in prijs), 11.5% in ES (BTW+zegelrecht).' },
            { key: 'stampDuty', label: 'Zegelrecht', tooltip: 'Belasting op juridische documenten, van toepassing in Portugal (0.8%).' },
            { key: 'brokerageCosts', label: 'Makelaarskosten', tooltip: 'Commissie voor de makelaar. Alleen voor koper in Italië (ca. 2.5%).' },
            { key: 'legalCosts', label: 'Advocaatkosten', tooltip: 'Kosten voor juridische controle. Vast bedrag in Montenegro, percentage in Spanje en Portugal.' },
            { key: 'notaryCosts', label: 'Notariskosten', tooltip: 'Kosten voor de notaris. Vast bedrag in ME en IT, percentage in ES.' },
            { key: 'notaryRegistrationCosts', label: 'Notaris & Registratie', tooltip: 'Gecombineerde post voor notaris- en registratiekosten in Portugal.' },
            { key: 'registrationCosts', label: 'Kadaster registratie', tooltip: 'Kosten voor registratie in het eigendomsregister.' },
            { key: 'translatorCosts', label: 'Tolk (verplicht)', tooltip: 'Verplichte kosten voor een beëdigd vertaler bij de notaris in Montenegro.' },
            { key: 'otherCosts', label: 'Overige kosten', tooltip: 'Extra kosten zoals een verplicht NIE-nummer in Spanje of administratieve heffingen in Italië.' }
        ];

        let tableHTML = `<thead><tr><th>Kostenpost</th><th class="numeric-cell">Montenegro</th><th class="numeric-cell">Spanje</th><th class="numeric-cell">Portugal</th><th class="numeric-cell">Italië</th></tr></thead><tbody>`;
        const totals = { montenegro: 0, spanje: 0, portugal: 0, italië: 0 };
        const countryKeys = ['montenegro', 'spanje', 'portugal', 'italië'];
        
        costKeys.forEach(item => {
            const values = countryKeys.map(ck => allResults[ck].costBreakdown[item.key] || 0);
            if (values.some(v => v > 0)) {
                tableHTML += `<tr><td>${item.label}<span class="tooltip"><i class="tooltip-icon">i</i><span class="tooltip-text">${item.tooltip}</span></span></td>`;
                values.forEach((val, i) => {
                    tableHTML += `<td class="numeric-cell">${formatCurrency(val)}</td>`;
                    totals[countryKeys[i]] += val;
                });
                tableHTML += `</tr>`;
            }
        });

        tableHTML += `</tbody><tfoot><tr class="total-row"><td>Totaal bijkomende kosten</td>`;
        countryKeys.forEach(ck => tableHTML += `<td class="numeric-cell">${formatCurrency(totals[ck])}</td>`);
        tableHTML += `</tr><tr class="total-row"><td>Totaal als % van Koopsom</td>`;
        countryKeys.forEach(ck => tableHTML += `<td class="numeric-cell">${formatPercent(purchasePrice > 0 ? totals[ck] / purchasePrice : 0, 1)}</td>`);
        tableHTML += `</tr><tr class="total-row"><td><strong>Totale Aankoopsom (incl. kosten)</strong></td>`;
        countryKeys.forEach(ck => {
            const totalPurchasePrice = purchasePrice + totals[ck];
            tableHTML += `<td class="numeric-cell"><strong>${formatCurrency(totalPurchasePrice)}</strong></td>`;
        });
        tableHTML += `</tr></tfoot>`;
        
        document.getElementById('onetime-costs-comparison-table').innerHTML = tableHTML;
    }

    function displayAnnualAndRoi(inputs, allResults, formatCurrency, formatPercent) {
        const { montenegro } = allResults;
        const totalAnnualCosts = montenegro.totalAnnualCostsBeforeFinancing + montenegro.annualFinancingCost + montenegro.taxAmount;
        document.getElementById('costs-table').innerHTML = `<tbody>
            <tr><td>Onroerendgoedbelasting<span class="tooltip"><i class="tooltip-icon">i</i><span class="tooltip-text">Jaarlijkse belasting op onroerend goed, betaald aan de gemeente. Geschat op 0.25% van de waarde.</span></span></td><td class="numeric-cell">${formatCurrency(montenegro.annualPropertyTax)}</td></tr>
            <tr><td>Verzekering<span class="tooltip"><i class="tooltip-icon">i</i><span class="tooltip-text">Geschatte jaarlijkse premie voor een opstalverzekering.</span></span></td><td class="numeric-cell">${formatCurrency(montenegro.annualInsurance)}</td></tr>
            <tr><td>Onderhoud<span class="tooltip"><i class="tooltip-icon">i</i><span class="tooltip-text">Jaarlijkse reservering voor onderhoudskosten.</span></span></td><td class="numeric-cell">${formatCurrency(montenegro.annualMaintenance)}</td></tr>
            <tr class="total-row"><td>Totale Jaarlijkse Kosten</td><td class="numeric-cell">${formatCurrency(totalAnnualCosts)}</td></tr>
        </tbody>`;
        
        const rentalIncomeTable = document.getElementById('rental-income-table').parentElement;
        const netRentalResultTable = document.getElementById('net-rental-result-table').parentElement;
        if (inputs.usageType !== 'Vakantiewoning') {
             rentalIncomeTable.style.display = 'block';
             netRentalResultTable.style.display = 'block';
             document.getElementById('rental-income-table').innerHTML = `<tbody><tr><td>Bruto Huurinkomsten</td><td class="numeric-cell">${formatCurrency(montenegro.grossAnnualRentalIncome)}</td></tr><tr><td>Beheerkosten (${formatPercent(montenegro.managementFeeRate, 0)})</td><td class="numeric-cell">-${formatCurrency(montenegro.rentalManagementFee)}</td></tr><tr class="total-row"><td>Netto Huurinkomsten</td><td class="numeric-cell">${formatCurrency(montenegro.netAnnualRentalIncome)}</td></tr></tbody>`;
             document.getElementById('net-rental-result-table').innerHTML = `<tbody><tr><td>Netto Huurinkomsten</td><td class="numeric-cell">${formatCurrency(montenegro.netAnnualRentalIncome)}</td></tr><tr><td style="padding-left: 2rem;">- Jaarlijkse Kosten</td><td class="numeric-cell">-${formatCurrency(montenegro.totalAnnualCostsBeforeFinancing)}</td></tr><tr><td style="padding-left: 2rem;">- Financieringskosten</td><td class="numeric-cell">-${formatCurrency(montenegro.annualFinancingCost)}</td></tr><tr><td style="padding-left: 2rem;">- Belasting op Huurinkomsten</td><td class="numeric-cell">-${formatCurrency(montenegro.taxAmount)}</td></tr><tr class="total-row"><td>Netto Cashflow (Eindresultaat)</td><td class="numeric-cell">${formatCurrency(montenegro.netAnnualCashflow)}</td></tr></tbody>`;
        } else {
             rentalIncomeTable.style.display = 'none';
             netRentalResultTable.style.display = 'block';
             const totalCostsOwnUse = montenegro.totalAnnualCostsBeforeFinancing + montenegro.annualFinancingCost;
             document.getElementById('net-rental-result-table').innerHTML = `<tbody><tr class="total-row"><td>Netto Jaarlijkse Kosten (eigen gebruik)</td><td class="numeric-cell">${formatCurrency(totalCostsOwnUse * -1)}</td></tr></tbody>`;
        }

        document.getElementById('roi-table').innerHTML = `<tbody><tr><td>Netto Huurrendement</td><td class="numeric-cell">${formatPercent(montenegro.netRentalYield, 2)}</td></tr></tbody>`;
    }
    
    function destroyChart(chartId) {
        if (charts[chartId]) charts[chartId].destroy();
    }

    function drawChartsForPanel(panelId) {
        const { inputs, results } = lastCalculation;
        if (!inputs || !results) return;

        Chart.defaults.font.family = "'Open Sans', sans-serif";
        Chart.defaults.color = 'var(--text-secondary)';
        const sharedOptions = { responsive: true, maintainAspectRatio: false, animation: { duration: 800 } };

        if (panelId === 'summary') {
            destroyChart('country-comparison-chart');
            const comparisonCtx = document.getElementById('country-comparison-chart');
            if (comparisonCtx) {
                charts['country-comparison-chart'] = new Chart(comparisonCtx, { type: 'bar',
                    data: { labels: ['Montenegro', 'Spanje', 'Portugal', 'Italië'],
                        datasets: [{ label: 'Netto Huurrendement', data: [results.montenegro.netRentalYield * 100, results.spanje.netRentalYield * 100, results.portugal.netRentalYield * 100, results.italië.netRentalYield * 100], backgroundColor: ['#d4915f', '#F0B429', '#00A5CF', '#31C48D'] }] },
                    options: { ...sharedOptions, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { callback: value => value.toFixed(1) + '%' } } } }
                });
            }

            destroyChart('cumulative-appreciation-chart');
            const appreciationCtx = document.getElementById('cumulative-appreciation-chart');
            if (appreciationCtx) {
                 charts['cumulative-appreciation-chart'] = new Chart(appreciationCtx, { type: 'line',
                    data: { labels: ['2019', '2020', '2021', '2022', '2023', '2024'], datasets: [
                        { label: 'Montenegro', data: [100, 92.9, 116.7, 134.4, 160.6, 180.1], borderColor: '#d4915f', tension: 0.1, pointBackgroundColor: '#d4915f' },
                        { label: 'Spanje', data: [100, 102.1, 105.9, 113.7, 118.3, 128.1], borderColor: '#F0B429', tension: 0.1, pointBackgroundColor: '#F0B429' },
                        { label: 'Portugal', data: [100, 106.0, 117.8, 128.0, 139.1, 150.8], borderColor: '#00A5CF', tension: 0.1, pointBackgroundColor: '#00A5CF' },
                        { label: 'Italië', data: [100, 101.5, 103.5, 105.7, 107.9, 115.1], borderColor: '#31C48D', tension: 0.1, pointBackgroundColor: '#31C48D' }
                    ]}, options: { ...sharedOptions, scales: { y: { title: { display: true, text: 'Prijsindex (2019 = 100)' } } } }
                });
            }
        }

        if (panelId === 'financial') {
            destroyChart('investment-breakdown-chart');
            const investmentCtx = document.getElementById('investment-breakdown-chart');
            if (investmentCtx) {
                const breakdown = results.montenegro.costBreakdown;
                const chartDataPoints = {
                    'Aankoopprijs': results.montenegro.purchasePrice,
                    'Belasting': breakdown.tax,
                    'Advocaat': breakdown.legalCosts,
                    'Notaris': breakdown.notaryCosts,
                    'Registratie': breakdown.registrationCosts,
                    'Tolk': breakdown.translatorCosts,
                    'Inrichting': inputs.furnishingCosts
                };
                const chartLabels = Object.keys(chartDataPoints).filter(key => chartDataPoints[key] > 0);
                const chartData = Object.values(chartDataPoints).filter(value => value > 0);
                charts['investment-breakdown-chart'] = new Chart(investmentCtx, { type: 'doughnut',
                    data: { labels: chartLabels, datasets: [{ data: chartData, backgroundColor: ['#042943', '#d4915f', '#00A5CF', '#627D98', '#E12D39', '#F0B429', '#31C48D'], borderWidth: 0 }] },
                    options: { ...sharedOptions, cutout: '60%', plugins: { legend: { position: 'bottom', labels: { boxWidth: 12 } } } }
                });
            }
            
            destroyChart('annual-costs-chart');
            const costsCtx = document.getElementById('annual-costs-chart');
            if (costsCtx) {
                const { montenegro } = results;
                const costPoints = { 'Vastgoedbelasting': montenegro.annualPropertyTax, 'Verzekering': montenegro.annualInsurance, 'Onderhoud': montenegro.annualMaintenance, 'Financiering': montenegro.annualFinancingCost, 'Huur-belasting': montenegro.taxAmount };
                const costsLabels = Object.keys(costPoints).filter(key => costPoints[key] > 0);
                const costsData = Object.values(costPoints).filter(value => value > 0);
                charts['annual-costs-chart'] = new Chart(costsCtx, { type: 'doughnut',
                    data: { labels: costsLabels, datasets: [{ data: costsData, backgroundColor: ['#042943', '#d4915f', '#00A5CF', '#627D98', '#F0B429'], borderWidth: 0 }] },
                    options: { ...sharedOptions, cutout: '60%', plugins: { legend: { position: 'bottom', labels: { boxWidth: 12 } } } }
                });
            }
        }
    }
    
    // Start de applicatie
    setupListeners();
    updateFormState();
});
</script>
</body>
</html>
