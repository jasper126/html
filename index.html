<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAY SIGHT Woning Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            /* Primaire kleuren (Aangepaste Baysight huisstijl) */
            --primary-blue: #042943;
            --primary-orange: #d4915f;
            --primary-turquoise: #00A5CF;
            
            /* Secundaire kleuren */
            --secondary-light: #F0F4F8;
            --secondary-medium: #D9E2EC;
            --secondary-dark: #627D98;
            
            /* Functionele kleuren */
            --success: #31C48D;
            --warning: #F0B429;
            --error: #E12D39;
            
            /* Tekst kleuren */
            --text-primary: #102A43;
            --text-secondary: #486581;
            --text-light: #829AB1;
            
            /* Achtergrond kleuren */
            --bg-light: #FFFFFF;
            --bg-off-white: #F8FAFC;
            --bg-highlight: #EFF6FF;

            /* Transitions */
            --transition-speed: 0.3s;
        }

        body {
            font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--bg-off-white);
            margin: 0;
            padding: 2rem 1rem;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .baysight-calculator-container {
            width: 100%;
            max-width: 1160px;
            margin: 0 auto;
            background-color: var(--bg-light);
            border-radius: 12px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08), 0 5px 15px rgba(0, 0, 0, 0.06);
            overflow: hidden;
            border: 1px solid var(--secondary-medium);
        }

        .calculator-header {
            background: linear-gradient(135deg, var(--primary-blue), #083e63);
            color: white;
            padding: 2.5rem 2rem;
            text-align: center;
        }

        .calculator-header h2 {
            margin: 0;
            font-size: 3rem;
            font-family: 'DM Serif Display', serif;
            font-weight: 400;
            color: var(--primary-orange);
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .calculator-tabs {
            display: flex;
            background-color: var(--secondary-light);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1 1 auto;
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all var(--transition-speed) ease;
            text-align: center;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background-color: var(--bg-highlight);
            color: var(--primary-blue);
        }

        .tab.active {
            color: var(--primary-blue);
            border-bottom-color: var(--primary-orange);
            background-color: var(--bg-light);
        }
        .tab.disabled {
            color: var(--text-light);
            cursor: not-allowed;
            background-color: var(--secondary-light);
            border-bottom-color: transparent;
        }


        .calculator-section {
            display: none;
            padding: 2.5rem;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .calculator-section.active {
            display: block;
        }

        .progress-indicator {
            position: relative;
            display: flex;
            justify-content: space-between;
            margin-bottom: 2.5rem;
            padding-bottom: 1rem;
        }

        .progress-bar {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            height: 4px;
            background-color: var(--secondary-medium);
            width: 100%;
            z-index: 1;
        }
        .progress-bar-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: var(--primary-orange);
            width: 0%;
            transition: width var(--transition-speed) ease-out;
            z-index: 2;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
            color: var(--text-light);
            font-weight: 600;
            font-size: 0.9rem;
            z-index: 3;
        }
        
        .progress-step .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--secondary-medium);
            color: var(--text-primary);
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 0.5rem;
            font-weight: 700;
            transition: all var(--transition-speed) ease;
            border: 3px solid var(--bg-light);
        }
        
        .progress-step.active .step-number {
            background-color: var(--primary-orange);
            color: white;
            transform: scale(1.1);
        }
        .progress-step.completed .step-number {
            background-color: var(--success);
            color: white;
        }
        .progress-step.active, .progress-step.completed {
            color: var(--primary-blue);
        }


        .input-form { display: none; }
        .input-form.active { display: block; animation: fadeIn 0.5s; }

        .form-group {
            margin-bottom: 1.75rem;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 0.6rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-control {
            box-sizing: border-box;
            display: block;
            width: 100%;
            padding: 0.8rem 1rem;
            font-size: 1rem;
            line-height: 1.5;
            color: var(--text-primary);
            background-color: var(--bg-light);
            border: 1px solid var(--secondary-medium);
            border-radius: 6px;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        .form-control:focus {
            border-color: var(--primary-turquoise);
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0, 165, 207, 0.25);
        }
        
        .label-with-tooltip {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.6rem;
        }
        .label-with-tooltip label { margin-bottom: 0; }

        input[type="range"] {
            -webkit-appearance: none; appearance: none;
            width: 100%; height: 10px;
            background: var(--secondary-light);
            border-radius: 5px; outline: none;
            transition: opacity .2s;
            background-image: linear-gradient(var(--primary-orange), var(--primary-orange));
            background-repeat: no-repeat;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 26px; height: 26px;
            background: var(--primary-orange);
            cursor: pointer; border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 1px 5px rgba(0,0,0,0.2);
            margin-top: -8px; /* Center thumb */
        }
        input[type="range"]::-moz-range-thumb {
            width: 26px; height: 26px;
            background: var(--primary-orange); cursor: pointer;
            border-radius: 50%; border: 4px solid white;
            box-shadow: 0 1px 5px rgba(0,0,0,0.2);
        }

        .range-value {
            display: flex; justify-content: space-between;
            margin-top: 0.75rem; color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .range-value .current-value {
            font-weight: 700; color: var(--primary-blue);
            background-color: var(--bg-highlight);
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
        }
        
        .toggle-switch-container {
            display: flex; align-items: center;
            justify-content: space-between;
            background-color: var(--secondary-light);
            padding: 0.75rem; border-radius: 8px;
        }
        .toggle-switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider {
            position: absolute; cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--secondary-dark);
            transition: .4s; border-radius: 34px;
        }
        .toggle-slider:before {
            position: absolute; content: "";
            height: 26px; width: 26px;
            left: 4px; bottom: 4px;
            background-color: white; transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider { background-color: var(--primary-orange); }
        input:checked + .toggle-slider:before { transform: translateX(26px); }
        
        .toggle-label-text { font-weight: 600; color: var(--text-secondary); transition: color 0.3s ease; }
        .toggle-label-text.inactive { color: var(--text-light); font-weight: 500; }

        .form-navigation { display: flex; justify-content: space-between; margin-top: 2.5rem; }

        .btn {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 0.8rem 1.6rem; border-radius: 6px;
            font-weight: 700; font-size: 1rem;
            text-align: center; cursor: pointer;
            transition: all var(--transition-speed) ease;
            border: 2px solid transparent; text-decoration: none;
            letter-spacing: 0.5px;
        }
        .btn .loader {
            width: 18px; height: 18px;
            border: 2px solid rgba(255,255,255,0.5);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            display: none;
        }

        .btn-primary { background-color: var(--primary-orange); color: white; }
        .btn-primary:hover { background-color: #c07e4d; color: white; box-shadow: 0 4px 15px rgba(212, 145, 95, 0.4); transform: translateY(-2px); }
        .btn-primary:active { transform: translateY(0); }

        .btn-secondary { background-color: var(--secondary-medium); color: var(--text-primary); }
        .btn-secondary:hover { background-color: var(--secondary-dark); color: white; }

        .btn:disabled {
            background-color: var(--secondary-medium);
            opacity: 0.7; cursor: not-allowed;
            box-shadow: none; transform: none;
        }
        .btn:disabled:hover { background-color: var(--secondary-medium); color: var(--text-primary); }

        .results-tabs { display: flex; flex-wrap: nowrap; overflow-x: auto; margin-bottom: 1.5rem; border-bottom: 1px solid var(--secondary-medium); }
        .results-tabs::-webkit-scrollbar { height: 5px; }
        .results-tabs::-webkit-scrollbar-thumb { background: var(--secondary-medium); border-radius: 10px; }

        .result-tab { padding: 0.75rem 1.25rem; cursor: pointer; font-weight: 600; color: var(--text-secondary); transition: all 0.3s ease; border-bottom: 3px solid transparent; margin-bottom: -2px; white-space: nowrap; }
        .result-tab:hover { color: var(--primary-blue); }
        .result-tab.active { color: var(--primary-blue); border-bottom-color: var(--primary-orange); }

        .result-panel { display: none; animation: fadeIn 0.5s; }
        .result-panel.active { display: block; }

        .summary-header { margin-bottom: 2rem; }
        .summary-header h3 { color: var(--primary-blue); font-size: 1.8rem; font-family: 'DM Serif Display', serif; }

        .property-info { font-size: 1.2rem; color: var(--text-secondary); }

        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }

        .summary-card {
            background-color: var(--bg-light);
            border: 1px solid var(--secondary-light);
            border-radius: 8px; padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.04);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative; overflow: hidden;
        }
        .summary-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
        .summary-card-icon {
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: var(--primary-orange);
            opacity: 0.15;
            font-size: 4rem;
        }
        .summary-card h4 {
            margin-top: 0; margin-bottom: 0.5rem;
            color: var(--primary-blue); font-size: 1.1rem;
        }
        .summary-value {
            font-size: 2.2rem; font-weight: 700;
            margin-bottom: 0.5rem; color: var(--primary-orange);
            font-family: 'DM Serif Display', serif;
        }
        .summary-card p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0;
        }
        
        .panel-section { margin-bottom: 3rem; }
        .panel-section h4 {
            font-family: 'DM Serif Display', serif;
            font-size: 1.5rem;
            color: var(--primary-blue); margin-bottom: 1rem;
            border-bottom: 2px solid var(--secondary-light);
            padding-bottom: 0.5rem;
        }

        .chart-container { height: 350px; margin-bottom: 1.5rem; width: 100%; }

        .data-table { width: 100%; border-collapse: collapse; margin-bottom: 1.5rem; }
        .data-table th, .data-table td { padding: 0.8rem 1rem; text-align: left; border-bottom: 1px solid var(--secondary-medium); vertical-align: middle; }
        .data-table th { background-color: var(--secondary-light); font-weight: 600; }
        .data-table tbody tr { transition: background-color var(--transition-speed) ease; }
        .data-table tbody tr:hover { background-color: var(--bg-highlight); }
        .data-table .total-row td { font-weight: 700; color: var(--primary-blue); }
        
        .data-table td.numeric-cell { text-align: right; font-feature-settings: "tnum"; font-weight: 500; }
        .data-table td.numeric-cell strong { font-weight: 700; }

        .considerations-list { background-color: var(--bg-highlight); border-radius: 8px; padding: 1.5rem; border-left: 5px solid var(--primary-turquoise); margin-top: 2rem; }
        .considerations-list h4 { margin-top: 0; color: var(--primary-blue); }
        .considerations-list ul { margin: 0; padding-left: 1.5rem; }
        .considerations-list li { margin-bottom: 0.75rem; }

        .result-actions { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--secondary-medium); }
        
        .tooltip { position: relative; display: inline-block; cursor: pointer; vertical-align: middle; }
        .tooltip .tooltip-icon {
            font-style: normal; font-weight: 700;
            display: inline-flex; justify-content: center; align-items: center;
            width: 18px; height: 18px; border-radius: 50%;
            background-color: var(--secondary-dark); color: white;
            font-size: 12px; margin-left: 8px;
            transition: background-color var(--transition-speed) ease;
        }
        .tooltip:hover .tooltip-icon { background-color: var(--primary-orange); }
        .tooltip .tooltip-text {
            visibility: hidden; width: 280px;
            background-color: var(--primary-blue); color: #fff;
            text-align: left; border-radius: 6px; padding: 10px 14px;
            position: absolute; z-index: 10;
            bottom: 135%; left: 50%;
            margin-left: -140px; opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(10px);
            font-size: 0.9rem; line-height: 1.4;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .tooltip .tooltip-text::after {
            content: ""; position: absolute;
            top: 100%; left: 50%;
            margin-left: -5px; border-width: 5px;
            border-style: solid; border-color: var(--primary-blue) transparent transparent transparent;
        }
        .tooltip:hover .tooltip-text { visibility: visible; opacity: 1; transform: translateY(0); }
        
        .cta-section { background-color: var(--secondary-light); border-radius: 8px; padding: 2.5rem; margin-top: 2rem; border: 1px solid var(--secondary-medium); }
        .cta-content { display: flex; align-items: center; gap: 2.5rem; }
        
        .cta-icon-container { flex-shrink: 0; color: var(--primary-orange); }
        .cta-icon-container svg { width: 80px; height: 80px; }
        .cta-text { flex-grow: 1; }
        .cta-text h2 {
            font-family: 'DM Serif Display', serif; color: var(--primary-blue);
            font-size: 2rem; margin-top: 0; margin-bottom: 1rem;
        }
        .cta-text p { margin-bottom: 1.5rem; color: var(--text-secondary); }
        
        .cta-form-inputs { display: flex; gap: 1rem; margin-bottom: 1.5rem; }
        .cta-form-inputs .form-group { flex: 1; margin-bottom: 0; }
        
        .btn-cta { width: 100%; padding: 1rem; font-size: 1.1rem; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        @media (max-width: 1159px) {
            .summary-grid { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        }
        
        @media (max-width: 768px) {
            body { padding: 0; }
            .baysight-calculator-container { border-radius: 0; border: none; }
            .calculator-section { padding: 1.5rem; }
            .calculator-header h2 { font-size: 2.5rem; }
            .progress-indicator { flex-direction: column; gap: 1rem; }
            .progress-bar { display: none; }
            .progress-step { text-align: left; display: flex; align-items: center; gap: 1rem; }
            .progress-step .step-number { margin: 0; }
            .form-navigation { flex-direction: column-reverse; gap: 1rem; }
            .result-actions { flex-direction: column; align-items: stretch; }
            .btn { width: 100%; box-sizing: border-box; }
            .cta-content { flex-direction: column; text-align: center; gap: 1.5rem; }
            .cta-form-inputs { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="baysight-calculator-container" id="main-container">
        <div class="calculator-header">
            <h2>Woning Calculator</h2>
        </div>

        <div class="calculator-tabs">
            <div class="tab active" data-tab="input">Start & Invoer</div>
            <div class="tab disabled" data-tab="results">Resultaten</div>
        </div>
        
        <div class="calculator-section active" id="input-section">
            <div class="progress-indicator">
                <div class="progress-bar"><div class="progress-bar-fill"></div></div>
                <div class="progress-step active" data-step="1"><div class="step-number">1</div>Woning</div>
                <div class="progress-step" data-step="2"><div class="step-number">2</div>Financieel</div>
                <div class="progress-step" data-step="3"><div class="step-number">3</div>Gebruik</div>
                <div class="progress-step" data-step="4"><div class="step-number">4</div>Voorkeuren</div>
            </div>
            
            <div class="input-form active" id="step-0">
                <div class="panel-section">
                    <h4>Uitleg van de Calculator</h4>
                    <p>Deze calculator is ontworpen om u een gedetailleerd en realistisch inzicht te geven in het potentiële rendement van een vastgoedinvestering. Onze berekeningen zijn niet zomaar schattingen; ze zijn gebaseerd op een diepgaande analyse van de meest recente, openbare data.</p>
                     <div class="considerations-list" style="border-left-color: var(--warning);">
                        <h4>Disclaimer</h4>
                        <p>Hoewel we streven naar maximale nauwkeurigheid, dient deze calculator als een indicatief hulpmiddel. De vastgoedmarkt is dynamisch en werkelijke resultaten kunnen afwijken. Deze berekening vormt geen financieel advies. Wij raden u ten zeerste aan om contact op te nemen voor een persoonlijk adviesgesprek om uw specifieke situatie te bespreken.</p>
                    </div>
                </div>
            </div>

            <div class="input-form" id="step-1">
                <h3>Woninggegevens in Montenegro</h3>
                 <div class="form-group">
                    <label for="purchasePrice">Aankoopprijs (€)</label>
                    <input type="number" id="purchasePrice" class="form-control" placeholder="bv. 250000" value="250000" min="0">
                </div>
                </div>

            <div class="input-form" id="step-2">
                <h3>Financiële gegevens</h3>
                 <div class="form-group">
                    <label for="ownCapital">Beschikbaar eigen vermogen (€)</label>
                    <input type="number" id="ownCapital" class="form-control" placeholder="bv. 150000" value="150000" min="0">
                    <div id="capital-warning" style="color: var(--warning); font-size: 0.9rem; margin-top: 0.5rem; display: none;"></div>
                </div>
                </div>
            <div class="form-navigation">
                <button class="btn btn-secondary btn-prev" disabled>Vorige</button>
                <button class="btn btn-primary btn-next">Volgende</button>
                <button class="btn btn-primary btn-calculate" style="display: none;"><div class="loader"></div><span>Bereken</span></button>
            </div>
        </div>
        
        <div class="calculator-section" id="results-section">
            <div class="results-tabs">
                <div class="result-tab active" data-result="summary">Samenvatting</div>
                <div class="result-tab" data-result="financial">Investering & Kosten</div>
                <div class="result-tab" data-result="rental">Verhuurpotentieel</div>
                <div class="result-tab" data-result="roi">Rendement Analyse</div>
            </div>
            
            <div class="result-panel active" id="summary-panel">
                <div class="summary-header">
                    <h3>Uw Investeringsprofiel</h3>
                    <div class="property-info">
                        <span id="summary-property-type">Appartement</span> in 
                        <span id="summary-region">Baai van Kotor</span>,
                        <span>Montenegro</span>
                    </div>
                </div>
                
                <div class="summary-grid">
                    <div class="summary-card">
                         <div class="summary-card-icon">💰</div>
                        <h4>Totale Investering</h4>
                        <div class="summary-value" id="summary-total-investment">€0</div>
                        <p>Aankoopprijs incl. alle bijkomende kosten.</p>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-card-icon">📈</div>
                        <h4>Netto Jaarlijks Resultaat</h4>
                        <div class="summary-value" id="summary-annual-result">€0</div>
                        <p>Cashflow na aftrek van alle kosten.</p>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-card-icon">🏡</div>
                        <h4>Netto Huurrendement</h4>
                        <div class="summary-value" id="summary-rental-yield">0%</div>
                        <p>Direct rendement uit verhuur op jaarbasis.</p>
                    </div>

                    <div class="summary-card">
                        <div class="summary-card-icon">📊</div>
                        <h4>Verwachte Waardestijging</h4>
                        <div class="summary-value" id="summary-appreciation">0%</div>
                        <p>Gemiddelde prognose per jaar (historisch).</p>
                    </div>
                </div>
                </div>
            </div>
    </div>

<script>
// De JavaScript logica blijft grotendeels hetzelfde. 
// Hieronder volgen de AANVULLINGEN voor de verbeterde UX.
document.addEventListener('DOMContentLoaded', function () {
    // --- BESTAANDE STATE VARIABLES ---
    let currentStep = 0;
    let charts = {};
    let lastCalculation = {};

    // --- BESTAANDE DOM ELEMENTEN ---
    const formSteps = document.querySelectorAll('.input-form');
    const progressSteps = document.querySelectorAll('.progress-step');
    const nextBtn = document.querySelector('.btn-next');
    const prevBtn = document.querySelector('.btn-prev');
    const calculateBtn = document.querySelector('.btn-calculate');
    const mainTabs = document.querySelectorAll('.tab');
    const calculatorSections = document.querySelectorAll('.calculator-section');
    const purchasePriceInput = document.getElementById('purchasePrice');
    const ownCapitalInput = document.getElementById('ownCapital');
    const progressBarFill = document.querySelector('.progress-bar-fill');
    
    // --- NIEUW: Functie om de progress bar te updaten ---
    function updateProgressBar() {
        const totalSteps = progressSteps.length;
        const progressPercentage = (currentStep > 0) ? ((currentStep - 1) / (totalSteps - 1)) * 100 : 0;
        progressBarFill.style.width = `${progressPercentage}%`;
    }

    // --- AANGEPAST: updateFormState ---
    function updateFormState() {
        const isStartScreen = currentStep === 0;
        document.querySelector('.progress-indicator').style.display = isStartScreen ? 'none' : 'flex';
        if (!isStartScreen) {
             updateProgressBar();
        }

        progressSteps.forEach((step, index) => {
            const stepNum = index + 1;
            step.classList.toggle('active', stepNum === currentStep);
            step.classList.toggle('completed', stepNum < currentStep);
        });

        formSteps.forEach(form => form.classList.remove('active'));
        document.getElementById(`step-${currentStep}`).classList.add('active');
        
        prevBtn.disabled = isStartScreen;
        prevBtn.style.display = isStartScreen ? 'none' : 'inline-flex';
        nextBtn.style.display = (isStartScreen || currentStep === formSteps.length - 1) ? 'none' : 'inline-flex';
        if(currentStep === 0) {
            const startButton = document.createElement('button');
            startButton.className = 'btn btn-primary';
            startButton.textContent = 'Start de Calculator';
            startButton.onclick = () => { currentStep++; updateFormState(); };
            document.querySelector('#step-0 .panel-section').appendChild(startButton);
            nextBtn.style.display = 'none'; // Verberg de standaard 'volgende' knop
        } else if (document.querySelector('#step-0 .btn-primary')) {
             document.querySelector('#step-0 .btn-primary').remove();
        }
        
        calculateBtn.style.display = currentStep === formSteps.length - 1 ? 'inline-flex' : 'none';
        nextBtn.disabled = (currentStep === 1 && (parseFloat(purchasePriceInput.value) || 0) <= 0);
        
        // Live capital warning check
        checkCapitalWarning();
    }
    
    // --- NIEUW: Functie voor live capital warning ---
    function checkCapitalWarning() {
        const purchasePrice = parseFloat(purchasePriceInput.value) || 0;
        const ownCapital = parseFloat(ownCapitalInput.value) || 0;
        const warningDiv = document.getElementById('capital-warning');

        if (ownCapital > 0 && purchasePrice > 0 && ownCapital < purchasePrice) {
            warningDiv.textContent = 'Let op: uw eigen vermogen is lager dan de aankoopprijs. Financiering is waarschijnlijk nodig.';
            warningDiv.style.display = 'block';
        } else {
            warningDiv.style.display = 'none';
        }
    }
    
    // --- AANGEPAST: Range Slider Update ---
    function setupRangeSlider(sliderId, displayId) {
        const slider = document.getElementById(sliderId);
        const display = document.getElementById(displayId);
        if(!slider || !display) return;
        
        const update = () => { 
            display.textContent = slider.value;
            // Update background fill of the slider
            const percentage = (slider.value - slider.min) / (slider.max - slider.min) * 100;
            slider.style.backgroundSize = `${percentage}% 100%`;
        };
        slider.addEventListener('input', update);
        update(); // Initial call
    }
    
    // --- AANGEPAST: runCalculation met loading state ---
    function runCalculation() {
        const loader = calculateBtn.querySelector('.loader');
        const btnText = calculateBtn.querySelector('span');

        loader.style.display = 'inline-block';
        btnText.textContent = 'Berekenen...';
        calculateBtn.disabled = true;

        // Simulate calculation time for better UX
        setTimeout(() => {
            const inputs = gatherInputs();
            const results = calculateAll(inputs);
            lastCalculation = { inputs, results };  
            displayResults(inputs, results);

            const resultsTab = document.querySelector('.tab[data-tab="results"]');
            resultsTab.classList.remove('disabled');
            switchMainTab(resultsTab);
            
            // Reset button
            loader.style.display = 'none';
            btnText.textContent = 'Bereken';
            calculateBtn.disabled = false;
        }, 800); // 0.8s delay
    }
    
    // --- Event Listeners Setup ---
    function setupListeners() {
        nextBtn.addEventListener('click', () => { /* ... bestaande code ... */ });
        prevBtn.addEventListener('click', () => { /* ... bestaande code ... */ });
        calculateBtn.addEventListener('click', runCalculation);
        
        // Live feedback op input
        purchasePriceInput.addEventListener('input', checkCapitalWarning);
        ownCapitalInput.addEventListener('input', checkCapitalWarning);
        
        // ... rest van de bestaande listeners ...
    }
    
    // --- DE REST VAN DE JAVASCRIPT BLIJFT FUNCTIONEEL IDENTIEK ---
    // ... (gatherInputs, calculateAll, calculateCountry, displayResults, etc.) ...
    
    // Start de applicatie
    setupListeners();
    updateFormState(); // Initial call
    setupRangeSlider('personalUsageWeeks', 'personalUsageWeeksValue');
});
</script>
</body>
</html>
